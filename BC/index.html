<!-- Birthday Code v1.1A1 -->
<!--
Version Detail Notes
App Version: v1.1A1
Base: v1.0 (simplified rebuild)
Changes:
- Simplified to a single-page birthday report generator (no panels, no streamer mode).
- Inputs: Month, Day, Year + Generate button.
- Generates a styled report with multiple interpretation lenses (Western astrology, Chinese zodiac, numerology, synthesis, overlaps).
- Export button downloads the current report as a .txt file.
- BOF/EOF version blocks included for easy reference.
Important:
- This app is OFFLINE-FIRST and does NOT fetch web content at runtime.
- “Book of Birthdays” style content should be added as your own paraphrase notes if desired (copyright-safe).
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1324" />
  <title>Birthday Code</title>

  <style>
    :root{
      --bg0:#071022;
      --bg1:#0b1324;
      --bg2:#0a1630;

      --panel: rgba(15, 26, 48, 0.66);
      --stroke: rgba(210, 230, 255, 0.16);
      --stroke2: rgba(210, 230, 255, 0.22);
      --strokeBold: rgba(160, 200, 255, 0.42);

      --accent:#2b4e7a;
      --accent2:#4b68ff;

      --text: rgba(238, 246, 255, 0.92);
      --muted: rgba(238, 246, 255, 0.68);
      --muted2: rgba(238, 246, 255, 0.50);

      --ok: rgba(120, 255, 210, 0.92);
      --warn: rgba(255, 210, 120, 0.92);
      --danger: rgba(255, 110, 120, 0.95);

      --r: 22px;
      --shadow: 0 18px 55px rgba(0,0,0,.40);
      --shadow2: 0 10px 24px rgba(0,0,0,.32);

      --pad: 14px;
      --pad2: 18px;

      --font: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

      --fz0: 16px;
      --fz1: 18px;
      --fz2: 22px;
      --fz3: 28px;
      --fz4: 36px;

      --lh: 1.28;
      --tap: 56px;
      --pill: 999px;
    }

    *{ box-sizing: border-box; }
    html, body{ height:100%; }

    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(900px 600px at 15% 10%, rgba(90,120,255,.20), transparent 60%),
        radial-gradient(800px 600px at 85% 15%, rgba(80,220,255,.12), transparent 60%),
        radial-gradient(900px 700px at 50% 95%, rgba(130,90,255,.13), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 55%, var(--bg2));
      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;
      overflow-x: hidden;
    }

    .wrap{
      min-height: 100%;
      padding:
        calc(env(safe-area-inset-top) + 14px)
        calc(env(safe-area-inset-right) + 14px)
        calc(env(safe-area-inset-bottom) + 14px)
        calc(env(safe-area-inset-left) + 14px);
      display:flex;
      flex-direction: column;
      gap: 12px;
      max-width: 980px;
      margin: 0 auto;
    }

    .brandCard{
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(15,26,48,.70), rgba(15,26,48,.52));
      border: 1px solid var(--accent);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      padding: var(--pad2);
      display:flex;
      align-items: center;
      gap: 14px;
    }

    .logo{
      width: 54px;
      height: 54px;
      flex: 0 0 auto;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
    }

    .brandText{
      display:flex;
      flex-direction: column;
      gap: 4px;
      min-width: 0;
    }

    .title{
      font-size: var(--fz4);
      font-weight: 950;
      letter-spacing: .2px;
      line-height: 1.05;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .subtitle{
      font-size: var(--fz0);
      color: var(--muted);
      line-height: var(--lh);
      font-weight: 750;
    }

    .card{
      border-radius: var(--r);
      border: 1px solid var(--accent);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      box-shadow: var(--shadow2);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      padding: var(--pad2);
    }

    .row{
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: flex-end;
    }

    label{
      display:block;
      font-size: var(--fz0);
      font-weight: 900;
      color: var(--muted);
      margin-bottom: 8px;
      letter-spacing: .2px;
    }

    .field{
      flex: 1 1 160px;
      min-width: 150px;
    }

    select, input[type="number"]{
      width: 100%;
      height: var(--tap);
      border-radius: 16px;
      border: 1px solid var(--stroke2);
      background: rgba(0,0,0,.14);
      color: var(--text);
      font-size: var(--fz1);
      font-weight: 900;
      padding: 0 14px;
      outline: none;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }

    .btnRow{
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .primaryBtn, .pillBtn{
      height: calc(var(--tap) + 6px);
      border-radius: 18px;
      border: 1px solid rgba(160,200,255,.35);
      background: linear-gradient(180deg, rgba(75,104,255,.42), rgba(43,78,122,.34));
      color: var(--text);
      font-size: var(--fz2);
      font-weight: 950;
      letter-spacing: .2px;
      box-shadow: 0 18px 40px rgba(0,0,0,.38);
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      padding: 0 18px;
      flex: 1 1 260px;
      min-width: 220px;
    }
    .primaryBtn:active, .pillBtn:active{ transform: translateY(1px); }

    .pillBtn{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border: 1px solid var(--stroke2);
      font-size: var(--fz1);
      font-weight: 900;
      box-shadow: 0 10px 24px rgba(0,0,0,.26);
      flex: 1 1 220px;
      min-width: 200px;
    }
    .pillBtn[disabled], .primaryBtn[disabled]{
      opacity: .55;
      cursor:not-allowed;
      transform:none !important;
    }

    .msg{
      margin-top: 10px;
      font-size: var(--fz0);
      font-weight: 850;
      color: var(--warn);
      line-height: var(--lh);
      display:none;
    }

    .reportShell{
      border-radius: var(--r);
      border: 1px solid var(--accent);
      background: linear-gradient(180deg, rgba(15,26,48,.62), rgba(15,26,48,.42));
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow:hidden;
    }

    .reportTop{
      padding: var(--pad2);
      border-bottom: 1px solid rgba(210,230,255,.10);
      display:flex;
      flex-direction: column;
      gap: 8px;
    }

    .reportTitle{
      font-size: var(--fz3);
      font-weight: 950;
      letter-spacing: .2px;
      line-height: 1.05;
    }

    .reportMeta{
      font-size: var(--fz0);
      color: var(--muted);
      font-weight: 850;
      line-height: var(--lh);
    }

    .chips{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 7px 12px;
      border-radius: var(--pill);
      border: 1px solid var(--stroke2);
      background: rgba(0,0,0,.12);
      font-size: 14px;
      font-weight: 950;
      letter-spacing: .2px;
      color: rgba(210,230,255,.90);
      white-space: nowrap;
    }

    .reportBody{
      padding: var(--pad2);
      max-height: 62vh;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }

    h3{
      margin: 18px 0 10px;
      font-size: var(--fz2);
      font-weight: 950;
      letter-spacing: .2px;
      line-height: 1.05;
    }

    p{
      margin: 10px 0;
      font-size: var(--fz1);
      line-height: var(--lh);
      color: rgba(238,246,255,.90);
      font-weight: 780;
    }

    ul{
      margin: 10px 0 10px 18px;
      padding: 0;
    }

    li{
      margin: 8px 0;
      font-size: var(--fz1);
      line-height: var(--lh);
      color: rgba(238,246,255,.90);
      font-weight: 850;
    }

    .hint{
      font-size: var(--fz0);
      color: var(--muted2);
      font-weight: 850;
      line-height: var(--lh);
    }

    .rule{
      height: 1px;
      background: rgba(210,230,255,.12);
      margin: 16px 0;
    }

    .footer{
      margin-top: auto;
      padding: 10px 4px 0 4px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      color: var(--muted2);
      font-size: 13px;
      font-weight: 900;
      letter-spacing: .2px;
    }

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 13px;
      font-weight: 900;
      color: rgba(220,240,255,.85);
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(210,230,255,.14);
      border-radius: 10px;
      padding: 3px 8px;
      display:inline-block;
    }

    @media (max-width: 520px){
      .title{ white-space: normal; }
      .primaryBtn, .pillBtn{ min-width: 100%; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="brandCard">
      <svg class="logo" viewBox="0 0 64 64" aria-hidden="true">
        <defs>
          <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#7aa7ff" stop-opacity="0.95"/>
            <stop offset="1" stop-color="#4b68ff" stop-opacity="0.85"/>
          </linearGradient>
          <radialGradient id="g2" cx="50%" cy="40%" r="60%">
            <stop offset="0" stop-color="#eaf5ff" stop-opacity="0.95"/>
            <stop offset="1" stop-color="#9fd3ff" stop-opacity="0.25"/>
          </radialGradient>
        </defs>
        <circle cx="32" cy="26" r="10" fill="url(#g2)" opacity="0.55"/>
        <ellipse cx="32" cy="16" rx="16" ry="6" fill="none" stroke="url(#g1)" stroke-width="3" opacity="0.85"/>
        <path d="M32 22l3.8 7.8 8.6 1.2-6.2 6 1.5 8.5-7.7-4.1-7.7 4.1 1.5-8.5-6.2-6 8.6-1.2z"
              fill="url(#g1)" opacity="0.92"/>
        <path d="M12 40c7 6 13 8 20 8s13-2 20-8" fill="none" stroke="rgba(160,200,255,.55)" stroke-width="3" stroke-linecap="round"/>
        <path d="M10 34c8 10 17 14 22 14s14-4 22-14" fill="none" stroke="rgba(75,104,255,.35)" stroke-width="3" stroke-linecap="round"/>
      </svg>
      <div class="brandText">
        <div class="title">Birthday Code</div>
        <div class="subtitle">A single-page birthday meaning generator (offline-first).</div>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div class="field">
          <label for="month">Month</label>
          <select id="month"></select>
        </div>
        <div class="field">
          <label for="day">Day</label>
          <select id="day"></select>
        </div>
        <div class="field">
          <label for="year">Year</label>
          <input id="year" type="number" inputmode="numeric" placeholder="e.g., 1997" />
        </div>
      </div>

      <div class="btnRow">
        <button class="primaryBtn" id="btnGen" type="button">Generate Birthday Code</button>
        <button class="pillBtn" id="btnExport" type="button" disabled>Export Report</button>
      </div>

      <div class="msg" id="msg"></div>
      <div class="hint" style="margin-top:10px;">
        Note: This app does not pull web data at runtime. To incorporate “Book of Birthdays” style detail, add your own paraphrased notes in code later (copyright-safe).
      </div>
    </div>

    <div class="reportShell" id="reportShell" style="display:none;">
      <div class="reportTop">
        <div class="reportTitle" id="rTitle">Report</div>
        <div class="reportMeta" id="rMeta"></div>
        <div class="chips" id="chips"></div>
      </div>
      <div class="reportBody" id="rBody"></div>
    </div>

    <div class="footer">
      <div>Version <span class="kbd" id="vTag">v1.1A1</span></div>
      <div>Developed by <span class="kbd">Keyth Jyles</span></div>
    </div>
  </div>

  <script>
    "use strict";

    const APP_VERSION = "v1.1A1";
    const lastGenerated = { text: "", title: "" };

    const el = (id)=>document.getElementById(id);
    const monthEl = el("month");
    const dayEl = el("day");
    const yearEl = el("year");
    const msgEl = el("msg");
    const btnGen = el("btnGen");
    const btnExport = el("btnExport");

    const reportShell = el("reportShell");
    const rTitle = el("rTitle");
    const rMeta = el("rMeta");
    const chips = el("chips");
    const rBody = el("rBody");
    el("vTag").textContent = APP_VERSION;

    function pad2(n){ return String(n).padStart(2,"0"); }
    function clampInt(v, min, max){
      const n = parseInt(v,10);
      if (Number.isNaN(n)) return null;
      return Math.max(min, Math.min(max, n));
    }
    function daysInMonth(month, year){
      const m = clampInt(month,1,12) ?? 1;
      const y = clampInt(year,1,9999) ?? 2000;
      return new Date(y, m, 0).getDate();
    }
    function monthName(m){
      const names = ["January","February","March","April","May","June","July","August","September","October","November","December"];
      return names[(m-1)] || `Month ${m}`;
    }
    function fmtDate(m,d,y){
      return `${monthName(m)} ${d}, ${y}`;
    }
    function nowLocal(){
      try{ return new Date().toLocaleString(); }catch{ return String(Date.now()); }
    }
    function showMsg(txt, kind){
      msgEl.style.display = "block";
      msgEl.textContent = txt;
      msgEl.style.color =
        kind === "ok" ? "var(--ok)" :
        kind === "danger" ? "var(--danger)" :
        "var(--warn)";
    }
    function hideMsg(){
      msgEl.style.display = "none";
      msgEl.textContent = "";
    }

    // Deterministic seed utils (for “surprising” but repeatable flavor)
    function hashStr(str){
      let h = 2166136261 >>> 0;
      for (let i=0;i<str.length;i++){
        h ^= str.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return h >>> 0;
    }
    function pick(arr, seed){
      if (!arr.length) return "";
      return arr[seed % arr.length];
    }
    function shuffle(arr, seed){
      const a = arr.slice();
      let s = seed >>> 0;
      for (let i=a.length-1;i>0;i--){
        s = (Math.imul(s, 1664525) + 1013904223) >>> 0;
        const j = s % (i+1);
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // Inputs init
    (function initInputs(){
      monthEl.innerHTML = "";
      for (let m=1;m<=12;m++){
        const o = document.createElement("option");
        o.value = String(m);
        o.textContent = `${m} — ${monthName(m)}`;
        monthEl.appendChild(o);
      }

      const t = new Date();
      monthEl.value = String(t.getMonth()+1);
      yearEl.value = "1997";

      function refillDays(){
        const m = clampInt(monthEl.value,1,12) ?? 1;
        const y = clampInt(yearEl.value,1,9999) ?? 2000;
        const max = daysInMonth(m,y);
        const prev = clampInt(dayEl.value,1,31) ?? 1;
        dayEl.innerHTML = "";
        for (let d=1; d<=max; d++){
          const o = document.createElement("option");
          o.value = String(d);
          o.textContent = String(d);
          dayEl.appendChild(o);
        }
        dayEl.value = String(Math.min(prev, max));
      }

      refillDays();
      dayEl.value = "1";
      monthEl.addEventListener("change", refillDays);
      yearEl.addEventListener("input", refillDays);
    })();

    // Western astrology (sun sign) boundaries (tropical)
    const SUN_SIGNS = [
      { name:"Capricorn",  start:[12,22], end:[1,19],  element:"Earth", modality:"Cardinal", ruler:"Saturn",
        traits:["disciplined","strategic","reliable","status-aware","endurance"], shadow:["rigid","work-obsessed","guarded"] },
      { name:"Aquarius",   start:[1,20],  end:[2,18],  element:"Air",   modality:"Fixed",    ruler:"Uranus (modern), Saturn (traditional)",
        traits:["original","future-minded","independent","community-driven","unbothered"], shadow:["detached","contrarian","erratic"] },
      { name:"Pisces",     start:[2,19],  end:[3,20],  element:"Water", modality:"Mutable",  ruler:"Neptune (modern), Jupiter (traditional)",
        traits:["intuitive","compassionate","imaginative","absorbing","healing"], shadow:["escapist","over-trusting","foggy boundaries"] },
      { name:"Aries",      start:[3,21],  end:[4,19],  element:"Fire",  modality:"Cardinal", ruler:"Mars",
        traits:["bold","initiating","direct","competitive","fast"], shadow:["impulsive","hot-headed","impatient"] },
      { name:"Taurus",     start:[4,20],  end:[5,20],  element:"Earth", modality:"Fixed",    ruler:"Venus",
        traits:["steady","sensory","loyal","resourceful","patient"], shadow:["stubborn","possessive","resistant to change"] },
      { name:"Gemini",     start:[5,21],  end:[6,20],  element:"Air",   modality:"Mutable",  ruler:"Mercury",
        traits:["curious","quick","witty","multi-skilled","social"], shadow:["restless","scattered","inconsistent"] },
      { name:"Cancer",     start:[6,21],  end:[7,22],  element:"Water", modality:"Cardinal", ruler:"Moon",
        traits:["protective","nurturing","loyal","memory-rich","instinctive"], shadow:["moody","defensive","clingy"] },
      { name:"Leo",        start:[7,23],  end:[8,22],  element:"Fire",  modality:"Fixed",    ruler:"Sun",
        traits:["radiant","confident","creative","proud","generous"], shadow:["dramatic","attention-hungry","stubborn pride"] },
      { name:"Virgo",      start:[8,23],  end:[9,22],  element:"Earth", modality:"Mutable",  ruler:"Mercury",
        traits:["precise","helpful","analytical","practical","systems-minded"], shadow:["critical","anxious","over-correcting"] },
      { name:"Libra",      start:[9,23],  end:[10,22], element:"Air",   modality:"Cardinal", ruler:"Venus",
        traits:["harmonizing","social-smart","aesthetic","fair","negotiating"], shadow:["indecisive","people-pleasing","avoidant"] },
      { name:"Scorpio",    start:[10,23], end:[11,21], element:"Water", modality:"Fixed",    ruler:"Pluto (modern), Mars (traditional)",
        traits:["intense","truth-seeking","private","loyal","transformational"], shadow:["suspicious","controlling","obsessive"] },
      { name:"Sagittarius",start:[11,22], end:[12,21], element:"Fire",  modality:"Mutable",  ruler:"Jupiter",
        traits:["optimistic","explorative","blunt-honest","philosophical","big-picture"], shadow:["tactless","over-promising","restless"] }
    ];

    function getSunSign(m,d){
      for (const s of SUN_SIGNS){
        const [sm, sd] = s.start;
        const [em, ed] = s.end;
        if (sm <= em){
          if ((m > sm || (m === sm && d >= sd)) && (m < em || (m === em && d <= ed))) return s;
        } else {
          if ((m > sm || (m === sm && d >= sd)) || (m < em || (m === em && d <= ed))) return s;
        }
      }
      return null;
    }

    // Chinese zodiac (12-year cycle)
    const CH_ANIMALS = [
      { name:"Rat", traits:["resourceful","quick-minded","charming","strategic","opportunistic"], shadow:["anxious","manipulative","over-calculating"] },
      { name:"Ox", traits:["steady","strong-willed","reliable","patient","methodical"], shadow:["stubborn","slow-to-change","rigid"] },
      { name:"Tiger", traits:["bold","independent","magnetic","risk-tolerant","protective"], shadow:["reckless","domineering","restless"] },
      { name:"Rabbit", traits:["gentle","diplomatic","refined","careful","empathetic"], shadow:["avoidant","over-sensitive","hesitant"] },
      { name:"Dragon", traits:["powerful","ambitious","visionary","high-energy","confident"], shadow:["intense","impatient","ego-driven"] },
      { name:"Snake", traits:["perceptive","mysterious","wise","strategic","composed"], shadow:["secretive","jealous","calculating"] },
      { name:"Horse", traits:["free-spirited","energetic","adventurous","direct","independent"], shadow:["commitment-averse","impulsive","scattered"] },
      { name:"Goat", traits:["artistic","kind","gentle","harmonizing","intuitive"], shadow:["pessimistic","avoidant","insecure"] },
      { name:"Monkey", traits:["clever","playful","inventive","adaptive","fast-learning"], shadow:["tricky","restless","unreliable"] },
      { name:"Rooster", traits:["confident","sharp","organized","expressive","detail-aware"], shadow:["critical","showy","perfectionistic"] },
      { name:"Dog", traits:["loyal","protective","honest","steady","justice-minded"], shadow:["worry-prone","stubborn","suspicious"] },
      { name:"Pig", traits:["warm","generous","enjoys comfort","trusting","good-humored"], shadow:["naive","indulgent","avoidant of conflict"] }
    ];

    // Anchor: 2020 = Rat
    function getChineseZodiac(y){
      const idx = ((y - 2020) % 12 + 12) % 12;
      return CH_ANIMALS[idx];
    }

    // Numerology
    function sumDigits(nStr){
      let s = 0;
      for (const ch of nStr) if (ch >= "0" && ch <= "9") s += (ch.charCodeAt(0) - 48);
      return s;
    }
    function reduceNum(n, keepMasters){
      let cur = Math.abs(parseInt(n,10));
      if (Number.isNaN(cur)) return null;
      while (cur >= 10 && !(keepMasters && (cur === 11 || cur === 22 || cur === 33))){
        cur = sumDigits(String(cur));
      }
      return cur;
    }
    const NUM_TRAITS = {
      1: ["initiative","self-direction","decisive action","fresh starts","lead energy"],
      2: ["partnership","harmony","timing","empathy","quiet power"],
      3: ["expression","creativity","humor","social spark","storytelling"],
      4: ["structure","reliability","craft","grounding","method"],
      5: ["adaptation","freedom","curiosity","movement","experimentation"],
      6: ["care","responsibility","beauty","healing","home base"],
      7: ["analysis","inner truth","research","depth","spiritual curiosity"],
      8: ["ambition","results","management","material mastery","influence"],
      9: ["closure","compassion","legacy","big-picture","release"],
      11:["intuition","signal sensitivity","inspiration","pattern awareness","teaching"],
      22:["builder","systems thinking","scale","execution","legacy projects"],
      33:["service","uplift","heart leadership","mentor energy","healing presence"]
    };

    function lifePath(m,d,y){
      const rm = reduceNum(m, true);
      const rd = reduceNum(d, true);
      const ry = reduceNum(y, true);
      if (rm == null || rd == null || ry == null) return null;
      const total = rm + rd + ry;
      return reduceNum(total, true);
    }
    function birthdayNum(d){
      return reduceNum(d, true);
    }

    // Intrigue layer (deterministic)
    const HOOKS = [
      "You don’t announce your power. You demonstrate it.",
      "People underestimate you until the pattern becomes undeniable.",
      "Your real talent is timing: you know when to push and when to wait.",
      "You are not here to blend in. You are here to set a standard.",
      "Your life teaches others what follow-through looks like.",
      "You can read a room faster than most people can read a sentence."
    ];
    const QUESTIONS = [
      "What do you do that instantly changes the temperature in a room?",
      "Where do you demand precision—because you know sloppiness costs?",
      "What truth do you protect even when it’s unpopular?",
      "What comfort are you ready to outgrow this year?",
      "What pattern keeps repeating until you finally respond differently?"
    ];
    const MANTRAS = [
      "Move slow. Hit clean.",
      "Depth over noise.",
      "Build what lasts.",
      "Clarity first, speed second.",
      "Truth is a muscle."
    ];

    function overlapTraits(a, b){
      const setA = new Set(a.map(x=>x.toLowerCase()));
      const out = [];
      for (const t of b){
        if (setA.has(t.toLowerCase())) out.push(t);
      }
      return out;
    }

    function uniq(arr){
      const s = new Set();
      const out = [];
      for (const x of arr){
        const k = String(x).toLowerCase();
        if (s.has(k)) continue;
        s.add(k);
        out.push(x);
      }
      return out;
    }

    function renderReport(m,d,y){
      const seed = hashStr(`${y}-${pad2(m)}-${pad2(d)}`);
      const sun = getSunSign(m,d);
      const cz = getChineseZodiac(y);
      const lp = lifePath(m,d,y);
      const bn = birthdayNum(d);

      const numTraitsLP = (NUM_TRAITS[lp] || []).slice();
      const numTraitsBN = (NUM_TRAITS[bn] || []).slice();

      // Build overlaps: astrology traits vs numerology vs zodiac
      const sunTraits = sun ? sun.traits.slice() : [];
      const czTraits = cz ? cz.traits.slice() : [];

      const o1 = overlapTraits(sunTraits, numTraitsLP);
      const o2 = overlapTraits(czTraits, numTraitsLP);
      const o3 = overlapTraits(numTraitsBN, numTraitsLP);

      const overlaps = uniq([...o1, ...o2, ...o3]).slice(0,7);

      // Intrigue picks
      const hook = pick(HOOKS, seed ^ 0xA11CE);
      const qset = shuffle(QUESTIONS, seed ^ 0xB0B).slice(0,3);
      const mantra = pick(MANTRAS, seed ^ 0xC0DE);

      // Chips
      chips.innerHTML = "";
      const chipData = [];
      if (sun) chipData.push(`Sun: ${sun.name}`);
      if (cz) chipData.push(`Zodiac: ${cz.name}`);
      if (lp != null) chipData.push(`Life Path: ${lp}`);
      if (bn != null) chipData.push(`Birthday #: ${bn}`);
      for (const c of chipData){
        const s = document.createElement("span");
        s.className = "chip";
        s.textContent = c;
        chips.appendChild(s);
      }

      const title = fmtDate(m,d,y);
      rTitle.textContent = title;
      rMeta.textContent = `Generated locally • ${nowLocal()} • App ${APP_VERSION}`;

      const html = `
        <h3>Opening Read</h3>
        <p><b>${escapeHTML(hook)}</b></p>
        <p class="hint">This report blends cultural interpretation systems. It is for reflection and entertainment, not prediction or advice.</p>

        <div class="rule"></div>

        <h3>Western Astrology (Sun Sign)</h3>
        ${
          sun ? `
            <p><b>${escapeHTML(sun.name)}</b> — ${escapeHTML(sun.element)} / ${escapeHTML(sun.modality)} • Ruler: ${escapeHTML(sun.ruler)}</p>
            <p><b>Core drives:</b> ${escapeHTML(sun.traits.slice(0,5).join(", "))}.</p>
            <p class="hint"><b>Pressure pattern:</b> ${escapeHTML(sun.shadow.join(", "))}.</p>
          ` : `<p class="hint">Invalid date for sun sign.</p>`
        }

        <div class="rule"></div>

        <h3>Chinese Zodiac (12-year cycle)</h3>
        <p><b>${escapeHTML(cz.name)}</b> — ${escapeHTML(cz.traits.slice(0,5).join(", "))}.</p>
        <p class="hint"><b>Pressure pattern:</b> ${escapeHTML(cz.shadow.join(", "))}.</p>
        <p class="hint">Boundary note: Traditional Chinese zodiac changes at Lunar New Year (Jan/Feb), which varies by year.</p>

        <div class="rule"></div>

        <h3>Numerology</h3>
        <p><b>Life Path ${escapeHTML(String(lp))}</b> — ${escapeHTML((NUM_TRAITS[lp] || []).slice(0,5).join(", "))}.</p>
        <p><b>Birthday Number ${escapeHTML(String(bn))}</b> — ${escapeHTML((NUM_TRAITS[bn] || []).slice(0,5).join(", "))}.</p>
        <p class="hint">Master numbers (11/22/33) are preserved when they arise in reductions.</p>

        <div class="rule"></div>

        <h3>Overlapping Characteristics</h3>
        ${
          overlaps.length
            ? `<ul>${overlaps.map(t=>`<li><b>${escapeHTML(t)}</b> shows up in multiple lenses — it’s a “repeating signal.”</li>`).join("")}</ul>`
            : `<p class="hint">No strong keyword overlaps detected. That often means you express differently depending on context (adaptive signature).</p>`
        }

        <div class="rule"></div>

        <h3>Synthesis: “Birthday Code”</h3>
        <p>
          Your signature blends <b>${escapeHTML(sun ? sun.element : "mixed elements")}</b> motivation with
          <b>${escapeHTML(cz ? cz.name : "zodiac")}</b>-style instincts and a numerology emphasis on
          <b>${escapeHTML(String(lp))}</b>.
          This usually reads as: <b>${escapeHTML(pick([
            "quiet intensity with decisive execution",
            "strategic patience that looks effortless",
            "creative momentum with a high internal standard",
            "deep pattern-recognition that people feel before they understand",
            "a builder’s mind with a storyteller’s delivery"
          ], seed ^ 0x1234))}</b>.
        </p>

        <div class="rule"></div>

        <h3>Three Questions (Use on camera)</h3>
        <ul>
          ${qset.map(q=>`<li>${escapeHTML(q)}</li>`).join("")}
        </ul>

        <div class="rule"></div>

        <h3>Mantra</h3>
        <p><b>${escapeHTML(mantra)}</b></p>

        <div class="rule"></div>

        <h3>Sources & Method Notes</h3>
        <p class="hint">
          This is an offline app. It uses: standard sun-sign date ranges (tropical Western astrology), a simplified 12-year Chinese zodiac cycle,
          and digit-reduction numerology (with master-number preservation). It does not fetch or quote copyrighted material.
        </p>
        <p class="hint">
          If you want “Book of Birthdays” style date-specific content, add your own paraphrased notes for each date (copyright-safe), or we can
          add a local notes table you maintain.
        </p>
      `;

      rBody.innerHTML = html;
      reportShell.style.display = "block";
      btnExport.disabled = false;

      const plain = exportPlainText(title, sun, cz, lp, bn, overlaps, hook, qset, mantra);
      lastGenerated.text = plain;
      lastGenerated.title = title;
    }

    // Export: plain text report (download .txt)
    function exportPlainText(title, sun, cz, lp, bn, overlaps, hook, qset, mantra){
      const lines = [];
      lines.push("Birthday Code — Export Report");
      lines.push(`App Version: ${APP_VERSION}`);
      lines.push(`Generated: ${nowLocal()}`);
      lines.push(`Date: ${title}`);
      lines.push("How this report was created:");
      lines.push("- Generated locally on this device.");
      lines.push("- No web calls, no accounts, no cloud sync.");
      lines.push("- Includes: Western sun sign table, simplified Chinese zodiac cycle, numerology digit reduction, and a deterministic synthesis layer.");
      lines.push("Disclaimer: Entertainment / reflective tool. Not factual prediction. Not advice.");
      lines.push("----------------------------------------");
      lines.push("");
      lines.push("OPENING READ");
      lines.push(hook);
      lines.push("");

      lines.push("WESTERN ASTROLOGY (SUN SIGN)");
      if (sun){
        lines.push(`${sun.name} — ${sun.element} / ${sun.modality} • Ruler: ${sun.ruler}`);
        lines.push(`Core drives: ${sun.traits.slice(0,5).join(", ")}.`);
        lines.push(`Pressure pattern: ${sun.shadow.join(", ")}.`);
      } else {
        lines.push("Invalid date for sun sign.");
      }
      lines.push("");

      lines.push("CHINESE ZODIAC (12-year cycle)");
      lines.push(`${cz.name} — ${cz.traits.slice(0,5).join(", ")}.`);
      lines.push(`Pressure pattern: ${cz.shadow.join(", ")}.`);
      lines.push("Boundary note: Traditional Chinese zodiac changes at Lunar New Year (Jan/Feb), varies by year.");
      lines.push("");

      lines.push("NUMEROLOGY");
      lines.push(`Life Path: ${lp} — ${(NUM_TRAITS[lp] || []).slice(0,5).join(", ")}.`);
      lines.push(`Birthday Number: ${bn} — ${(NUM_TRAITS[bn] || []).slice(0,5).join(", ")}.`);
      lines.push("");

      lines.push("OVERLAPPING CHARACTERISTICS");
      if (overlaps.length) overlaps.forEach(t => lines.push(`- ${t}`));
      else lines.push("No strong keyword overlaps detected.");
      lines.push("");

      lines.push("THREE QUESTIONS");
      qset.forEach((q,i)=>lines.push(`${i+1}. ${q}`));
      lines.push("");

      lines.push("MANTRA");
      lines.push(mantra);
      lines.push("");

      lines.push("SOURCES & METHOD NOTES");
      lines.push("Offline app: uses common sun-sign date ranges (tropical), simplified 12-year Chinese zodiac, and numerology digit-reduction with master-number preservation.");
      lines.push("Does not fetch or quote copyrighted material. Add your own paraphrased date notes if desired.");

      return lines.join("\n");
    }

    function downloadText(filename, text){
      const blob = new Blob([text], { type:"text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(() => URL.revokeObjectURL(url), 4000);
    }

    function escapeHTML(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;");
    }

    // Generate handler
    btnGen.addEventListener("click", () => {
      hideMsg();
      const m = clampInt(monthEl.value,1,12);
      const d = clampInt(dayEl.value,1,31);
      const y = clampInt(yearEl.value,1,9999);

      if (!m || !d || !y){
        showMsg("Enter Month, Day, and a 4-digit Year.", "danger");
        return;
      }

      const max = daysInMonth(m,y);
      if (d > max){
        showMsg(`Invalid day for ${monthName(m)} ${y}. Max is ${max}.`, "danger");
        return;
      }

      renderReport(m,d,y);
      showMsg("Report generated.", "ok");
    });

    // Export handler
    btnExport.addEventListener("click", () => {
      if (!lastGenerated.text){
        showMsg("Generate a report first.", "warn");
        return;
      }
      const safe = lastGenerated.title
        .replaceAll(",","")
        .replaceAll(" ","_")
        .replaceAll("__","_");
      const fn = `Birthday_Code_${APP_VERSION}_${safe}.txt`;
      downloadText(fn, lastGenerated.text);
      showMsg("Export downloaded.", "ok");
    });
  </script>
</body>
</html>

<!--
=========================================
Birthday Code — EOF Version Detail
Version: v1.1A1
Single-file offline-first (no runtime web calls)
One page: Month/Day/Year → Generate → Styled report → Export
Footer includes version + Developed by Keyth Jyles
=========================================
-->
