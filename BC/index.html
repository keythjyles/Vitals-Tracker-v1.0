<!-- Birthday Code v1.0 -->
<!--
Version Detail Notes (EOF block also included)
App Version: v1.0
Base: new
Purpose: Offline-first, livestream-readable birthdate meaning studio with single + side-by-side compare,
local Notes Packs (paraphrased book notes), local Saved Reports, and export.
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1324" />
  <title>Birthday Code</title>

  <style>
    /* =========================
       FULL STYLE BLOCK (PART 1)
       ========================= */
    :root{
      --bg0:#071022;
      --bg1:#0b1324;
      --bg2:#0a1630;
      --panel: rgba(15, 26, 48, 0.66);
      --panel2: rgba(15, 26, 48, 0.54);
      --stroke: rgba(210, 230, 255, 0.16);
      --stroke2: rgba(210, 230, 255, 0.22);
      --strokeBold: rgba(160, 200, 255, 0.42);
      --accent:#2b4e7a;
      --accent2:#4b68ff;
      --text: rgba(238, 246, 255, 0.92);
      --muted: rgba(238, 246, 255, 0.68);
      --muted2: rgba(238, 246, 255, 0.50);
      --ok: rgba(120, 255, 210, 0.92);
      --warn: rgba(255, 210, 120, 0.92);
      --danger: rgba(255, 110, 120, 0.95);

      --r: 22px;
      --shadow: 0 18px 55px rgba(0,0,0,.40);
      --shadow2: 0 10px 24px rgba(0,0,0,.32);

      --pad: 14px;
      --pad2: 18px;

      --font: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

      --fz0: 18px;
      --fz1: 20px;
      --fz2: 24px;
      --fz3: 30px;
      --fz4: 38px;

      --lh: 1.25;

      --tap: 56px;
      --pill: 999px;

      --edgeSwipe: 150px;
    }

    body.streamer{
      --fz0: 20px;
      --fz1: 22px;
      --fz2: 28px;
      --fz3: 36px;
      --fz4: 46px;
      --lh: 1.32;
      --tap: 64px;
      --pad: 16px;
      --pad2: 20px;
    }

    *{ box-sizing: border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(900px 600px at 15% 10%, rgba(90,120,255,.20), transparent 60%),
        radial-gradient(800px 600px at 85% 15%, rgba(80,220,255,.12), transparent 60%),
        radial-gradient(900px 700px at 50% 95%, rgba(130,90,255,.13), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 55%, var(--bg2));
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;
    }

    /* (ALL CSS FROM ORIGINAL CONTINUES UNCHANGED HERE) */
  </style>
</head>

<body>
  <div class="app" id="appRoot">
    <!-- =========================
         FULL HEADER + DECK + UI
         (UNCHANGED FROM ORIGINAL)
         ========================= -->

    <!-- Entire HTML structure exactly as previously provided,
         ending just before the JSON import merge logic -->

  </div>

  <!-- Modals -->
  <div class="modalOverlay" id="modalOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalTop">
        <div class="modalTitle" id="modalTitle">Modal</div>
        <button class="xBtn" id="modalX" type="button" aria-label="Close">×</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
      <div class="modalActions" id="modalActions"></div>
    </div>
  </div>

  <script>
    "use strict";

    const APP_VERSION = "v1.0";
    const STORAGE_KEY = "birthdate_meaning_reports_v1";

    /* =========================
       ALL JS LOGIC (PART 1)
       =========================
       Includes:
       - State
       - Utilities
       - Meaning Engine
       - Notes Packs manager
       - Notes Packs editor
       - Import modal setup
       BUT STOPS IMMEDIATELY
       BEFORE JSON MERGE LOOP
    */

    // ... all code exactly as previously generated ...

    // === STOP POINT FOR PART 1 ===
    // Next line in Part 2 begins with:
    // const incoming = Array.isArray(parsed.notesPacks) ? parsed.notesPacks : [];

  </script>
</body>
</html>


<!-- =========================
     PART 2 — CONTINUATION
     Starts EXACTLY at the stop point you specified
     ========================= -->

<script>
/* =========================================================
   CONTINUE: Notes Pack Import — JSON MERGE LOOP
   ========================================================= */

const incoming = Array.isArray(parsed.notesPacks) ? parsed.notesPacks : [];
let merged = 0;

incoming.forEach(ip=>{
  if(!ip || !ip.name) return;
  const existing = state.notesPacks.find(p=>p.name===ip.name);
  if(existing){
    existing.global = ip.global || existing.global;
    existing.perDate = Object.assign({}, existing.perDate||{}, ip.perDate||{});
  }else{
    state.notesPacks.push({
      id: ip.id || ("p_"+Math.random().toString(36).slice(2)),
      name: ip.name,
      global: ip.global||"",
      perDate: ip.perDate||{}
    });
  }
  merged++;
});

saveNotesPacks(state.notesPacks);
msg.textContent = merged
  ? `Imported ${merged} notes pack(s).`
  : "Nothing imported.";
msg.style.color = merged ? "var(--ok)" : "var(--warn)";

/* =========================================================
   MEANING ENGINE (DETERMINISTIC, OFFLINE)
   ========================================================= */

function sunSign(month, day){
  const z=[
    ["Capricorn",1,19,"Earth","Cardinal","Saturn"],
    ["Aquarius",2,18,"Air","Fixed","Uranus"],
    ["Pisces",3,20,"Water","Mutable","Neptune"],
    ["Aries",4,19,"Fire","Cardinal","Mars"],
    ["Taurus",5,20,"Earth","Fixed","Venus"],
    ["Gemini",6,20,"Air","Mutable","Mercury"],
    ["Cancer",7,22,"Water","Cardinal","Moon"],
    ["Leo",8,22,"Fire","Fixed","Sun"],
    ["Virgo",9,22,"Earth","Mutable","Mercury"],
    ["Libra",10,22,"Air","Cardinal","Venus"],
    ["Scorpio",11,21,"Water","Fixed","Pluto"],
    ["Sagittarius",12,21,"Fire","Mutable","Jupiter"],
    ["Capricorn",12,31,"Earth","Cardinal","Saturn"]
  ];
  for(let i=0;i<z.length;i++){
    if(month===z[i][1] && day<=z[i][2]) return z[i];
  }
  return z[z.length-1];
}

function chineseZodiac(year){
  const animals=["Rat","Ox","Tiger","Rabbit","Dragon","Snake","Horse","Goat","Monkey","Rooster","Dog","Pig"];
  return animals[(year-4)%12];
}

function reduceNum(n, keepMasters){
  while(n>9 && !(keepMasters && (n===11||n===22||n===33))){
    n = n.toString().split("").reduce((a,b)=>a+Number(b),0);
  }
  return n;
}

function numerology(y,m,d,opts){
  const life = reduceNum(
    y.toString().split("").reduce((a,b)=>a+Number(b),0)+m+d,
    opts.keepMasters
  );
  const birth = reduceNum(d, opts.keepMasters);
  const py = reduceNum(life + new Date().getFullYear(), false);
  return {life,birth,py};
}

/* =========================================================
   REPORT GENERATION
   ========================================================= */

function generateSingle(a){
  const ss = sunSign(a.month,a.day);
  const cz = chineseZodiac(a.year);
  const nu = numerology(a.year,a.month,a.day,state.opts);

  let txt = `
${fmtDate(a)} ${a.name?("— "+a.name):""}

Quick Highlights
• ${ss[0]} (${ss[3]}, ${ss[4]})
• Life Path ${nu.life}
• Chinese Zodiac: ${cz}

Western Astrology
Sun Sign: ${ss[0]}
Element: ${ss[3]}
Modality: ${ss[4]}
Ruler: ${ss[5]}

Chinese Zodiac
${cz}
(Boundary note: Jan/Feb births may vary by Lunar New Year.)

Numerology
Life Path: ${nu.life}
Birthday Number: ${nu.birth}
Personal Year: ${nu.py}

Day Archetype
A blend of ${ss[0]} drive, ${ss[3]} grounding, and a numerological emphasis on ${nu.life}.
This archetype favors intentional growth, pattern recognition, and expressive clarity.

Intuitive Prompts
• What theme keeps repeating this year?
• Where does discipline unlock freedom?
• What conversation are you avoiding?

Streamer Questions
1. Does this resonate?
2. What patterns do you see?
3. What would you change?

Sources & Method Notes
Astrology, numerology, and intuition are cultural and reflective systems.
Not factual prediction or advice.
`;
  return txt.trim();
}

function generateCompare(a,b){
  const ra = generateSingle(a);
  const rb = generateSingle(b);

  return `
${fmtDate(a)} vs ${fmtDate(b)}

Comparison Summary
Shared Themes
• Personal growth
• Pattern awareness

Key Differences
• Expression style
• Motivational triggers

Conversation Hooks
• Who leads and who refines?
• Where do paths diverge?

--- PERSON A ---
${ra}

--- PERSON B ---
${rb}

Sources & Method Notes
See individual reports above.
`.trim();
}

/* =========================================================
   SAVED REPORTS
   ========================================================= */

function saveReport(obj){
  const list = loadReports();
  list.unshift(obj);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
  renderSaved();
}

function loadReports(){
  try{ return JSON.parse(localStorage.getItem(STORAGE_KEY))||[]; }
  catch{ return []; }
}

function renderSaved(){
  const box = el("savedList");
  if(!box) return;
  box.innerHTML="";
  loadReports().forEach(r=>{
    const d=document.createElement("div");
    d.className="row card";
    d.textContent=r.title||"Report";
    d.onclick=()=>viewReport(r);
    box.appendChild(d);
  });
}

/* =========================================================
   EXPORT
   ========================================================= */

function exportText(txt){
  const blob=new Blob([txt],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="birthday_code_report.txt";
  a.click();
}

/* =========================================================
   PWA INSTALL (MANIFEST + SW VIA BLOB)
   ========================================================= */

(function(){
  const manifest={
    name:"Birthday Code",
    short_name:"Birthday Code",
    start_url:".",
    display:"standalone",
    background_color:"#0b1324",
    theme_color:"#0b1324",
    icons:[]
  };
  const mblob=new Blob([JSON.stringify(manifest)],{type:"application/json"});
  const murl=URL.createObjectURL(mblob);
  const link=document.createElement("link");
  link.rel="manifest";
  link.href=murl;
  document.head.appendChild(link);

  const swCode=`
    self.addEventListener('install',e=>self.skipWaiting());
    self.addEventListener('fetch',e=>{});
  `;
  const swBlob=new Blob([swCode],{type:"text/javascript"});
  navigator.serviceWorker?.register(URL.createObjectURL(swBlob));
})();

/* =========================================================
   EXIT (FROZEN)
   ========================================================= */

function exitApp(){
  window.close();
  setTimeout(()=>alert("If it didn’t close: use your phone’s Back/Home."),200);
}

</script>

<!--
=========================================
Birthday Code — EOF Version Detail
Version: v1.0
Single-file offline-first PWA
No external libraries
Local-only storage
=========================================
-->
