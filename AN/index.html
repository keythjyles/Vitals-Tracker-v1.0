<!--
Angel Code — BOF Version Detail Notes
App Version: v1.2A13
Base: v1.2A12
Changes (requested):
- Home panel Install/Uninstall button spans full panel width.
- Remove the “Shows only when install is available…” instruction line (kept “Swipe left to view Calendar.”).
- Home panel Uninstall now closes the tab/window after OK (same close behavior style as big install flow).
- Big Install button hides whenever an Export report is displayed; returns only after refresh and only if not installed + install is available.
- Version advanced and BOF/EOF notes updated.
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1324" />
  <title>Angel Code</title>
  <link rel="manifest" id="manifestLink" href="#" />
  <style>
    :root{
      --bg0:#08101f;
      --bg1:#0b1324;
      --panel:#0c1528cc;
      --stroke:rgba(235,245,255,.16);
      --stroke2:rgba(235,245,255,.22);
      --strokeBold:rgba(180,210,255,.42);
      --text:rgba(235,245,255,.86);
      --muted:rgba(235,245,255,.58);
      --muted2:rgba(235,245,255,.42);

      --accentBorder: rgba(43,78,122,.85);
      --accentGlow: rgba(43,78,122,.18);
      --themeLine: rgba(43,78,122,.55);
      --themeLineSoft: rgba(43,78,122,.28);

      --shadow:0 14px 40px rgba(0,0,0,.38);
      --radius:26px;
      --btnH:56px;
      --pad:18px;
      --font: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 30% 0%, rgba(47,120,255,.22), transparent 55%),
        radial-gradient(900px 600px at 80% 20%, rgba(155,120,255,.10), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      display:flex;
      justify-content:center;
      padding: max(14px, env(safe-area-inset-top)) 12px max(14px, env(safe-area-inset-bottom));
      overflow:hidden;
    }

    .app{
      width:min(520px, 100%);
      height: 100%;
      display:flex;
      flex-direction:column;
      gap:6px;
      overflow:hidden;
    }

    .logoTitle{
      margin:4px 6px 0;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-shadow: 0 10px 22px rgba(0,0,0,.35);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .logoTitle svg{
      width:min(520px, 100%);
      height:auto;
      display:block;
    }
    .tinyVer{
      margin-top: 2px;
      font-size: 11px;
      line-height: 1;
      color: rgba(235,245,255,.36);
      letter-spacing: .2px;
      user-select:none;
    }

    .screenArea{
      position:relative;
      flex:1;
      overflow:hidden;
      border-radius: var(--radius);
      touch-action: pan-y;
    }

    .ptr{
      position:absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 50;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(235,245,255,.16);
      background: rgba(12,21,40,.86);
      backdrop-filter: blur(10px);
      box-shadow: 0 14px 34px rgba(0,0,0,.36);
      color: rgba(235,245,255,.84);
      font-weight: 850;
      font-size: 13px;
      letter-spacing: .2px;
      display:none;
      align-items:center;
      gap:10px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: none;
    }
    .ptr.show{ display:flex; }
    .ptrDot{
      width:10px; height:10px;
      border-radius: 50%;
      background: rgba(47,120,255,.88);
      box-shadow: 0 0 0 4px rgba(47,120,255,.18);
      opacity:.95;
    }
    .ptrHint{ opacity:.90; }
    .ptrSmall{ opacity:.60; font-weight:800; }

    .deck{
      position:absolute;
      inset:0;
      display:flex;
      width:200%;
      height:100%;
      transform: translate3d(0,0,0);
      will-change: transform;
    }
    .deck.anim{
      transition: transform 260ms cubic-bezier(.2,.9,.2,1);
    }

    .card{
      flex: 0 0 50%;
      width: 50%;
      height: 100%;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:3px solid var(--accentBorder);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: var(--pad);
      backdrop-filter: blur(10px);
      overflow:hidden;
      touch-action: pan-y;
      position:relative;
    }

    #home.card{
      border:none;
      box-shadow:none;
      background: transparent;
      backdrop-filter: none;
      padding: 0;
    }

    .hidden{ display:none !important; }

    .btn{
      height:var(--btnH);
      border-radius: 999px;
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.03);
      color:rgba(235,245,255,.78);
      font-weight:650;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0 18px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      font-size:18px;
      touch-action: manipulation;
      white-space:nowrap;
    }
    .btn:active{ transform: translateY(1px); }

    .btn.primary{
      background: linear-gradient(180deg, rgba(47,120,255,.92), rgba(47,120,255,.72));
      border-color: rgba(120,170,255,.55);
      color: rgba(235,245,255,.90);
    }

    .btn.danger{
      background: linear-gradient(180deg, rgba(255,80,80,.18), rgba(255,80,80,.10));
      border-color: rgba(255,120,120,.42);
      color: rgba(255,225,225,.92);
      box-shadow: 0 10px 26px rgba(0,0,0,.22);
    }

    .btn.small{
      height:44px;
      font-size:16px;
      padding:0 14px;
      font-weight:650;
      white-space:nowrap;
    }

    .btn:disabled{
      opacity:.55;
      filter:saturate(.85);
      transform:none !important;
      pointer-events:none;
    }

    .label{
      font-size:15px;
      color:var(--muted);
      font-weight:650;
      margin: 10px 4px 6px;
    }
    .subtle{
      font-size:14px;
      color:var(--muted2);
      margin: 6px 4px 0;
    }

    .field{
      border:2px solid var(--strokeBold);
      background: rgba(255,255,255,.06);
      color: rgba(235,245,255,.86);
      border-radius: 18px;
      height:54px;
      padding: 0 14px;
      font-size:18px;
      outline:none;
      width:100%;
    }
    .field::placeholder{ color: rgba(235,245,255,.35); }
    .field:focus{
      border-color: rgba(90,150,255,.78);
      box-shadow: 0 0 0 4px rgba(47,120,255,.16);
    }
    textarea.field{
      height:96px;
      padding: 12px 14px;
      resize:none;
      line-height:1.25;
    }

    .footerTiny{
      margin-top:8px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      font-size: 12px;
      color: rgba(235,245,255,.38);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .meaningCard{
      border:1px solid var(--themeLine);
      background: rgba(255,255,255,.03);
      border-radius: 22px;
      padding: 12px 12px 10px;
      margin-top: 10px;
    }

    .metaScroll{
      margin-top:10px;
      border:1px solid rgba(235,245,255,.10);
      background: rgba(255,255,255,.02);
      border-radius: 16px;
      padding: 10px 10px;
      max-height: 230px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      white-space: pre-wrap;
      line-height: 1.28;
      color: rgba(235,245,255,.82);
      font-size:14px;
      scrollbar-width: thin;
      scrollbar-color: rgba(235,245,255,.28) rgba(255,255,255,.06);
    }
    .metaScroll::-webkit-scrollbar{ width: 8px; }
    .metaScroll::-webkit-scrollbar-track{
      background: rgba(255,255,255,.05);
      border-radius: 999px;
    }
    .metaScroll::-webkit-scrollbar-thumb{
      background: rgba(235,245,255,.22);
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,.04);
    }

    .angelCardFrame{
      margin-top: 0;
      border: 2px solid rgba(90,150,255,.40);
      background: linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,.02));
      border-radius: 20px;
      box-shadow: 0 14px 34px rgba(0,0,0,.26);
      padding: 10px;
    }

    .angelHeaderLine{
      border: 1px solid rgba(235,245,255,.12);
      background: rgba(0,0,0,.08);
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 900;
      letter-spacing:.2px;
      color: rgba(235,245,255,.84);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }

    .angelBigNum{
      font-size:72px;
      font-weight:950;
      letter-spacing:.6px;
      line-height: .92;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding: 10px 10px 10px;
      border-radius: 16px;
      border: 1px solid rgba(235,245,255,.10);
      background: rgba(0,0,0,.10);
      color: rgba(235,245,255,.92);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      margin-top: 10px;
      margin-bottom: 10px;
      text-align:left;
    }

    .angelCardFrame .metaScroll{
      margin-top: 0;
      border: 1px solid rgba(235,245,255,.10);
      background: rgba(0,0,0,.10);
      border-radius: 16px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
    }

    .disclaimer{
      margin-top:8px;
      color: rgba(235,245,255,.44);
      font-size:12px;
      line-height:1.25;
    }

    /* HOME layout */
    #home{
      display:flex;
      flex-direction:column;
      gap:0;
      padding-bottom:0;
      height: 100%;
    }

    #homeScroll{
      flex: 1;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding: 0 0 10px;
      touch-action: pan-y;
      overscroll-behavior: contain;
    }
    .homeShell{
      margin: 10px 12px 0;
      border-radius: var(--radius);
      border:3px solid var(--accentBorder);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      padding: var(--pad);
      backdrop-filter: blur(10px);
    }

    .homeTopRow{
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom: 8px;
      margin-top: 2px;
    }
    .homeTopRow .field{
      flex: 1;
      height: 56px;
      border-radius: 22px;
    }
    .homeTopRow .btn{
      height: 56px;
      border-radius: 999px;
      min-width: 126px;
      font-weight: 850;
      font-size: 20px;
      padding: 0 22px;
    }

    .homeInstrOneLine{
      margin: 0 2px 0;
      color: rgba(235,245,255,.52);
      font-size: 14px;
      line-height: 1.25;
    }

    .bigInstallWrap{
      margin-top: 12px;
    }
    .bigInstallBtn{
      width: 100%;
      height: 64px;
      font-size: 22px;
      font-weight: 900;
      letter-spacing: .2px;
      border-radius: 999px;
      border: 2px solid rgba(120,170,255,.70);
      background: linear-gradient(180deg, rgba(47,120,255,.98), rgba(47,120,255,.70));
      box-shadow:
        0 18px 42px rgba(0,0,0,.36),
        0 0 0 6px rgba(47,120,255,.14);
      color: rgba(235,245,255,.94);
    }

    .homeActions{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin: 12px 0 0;
    }
    .homeActions .btn{
      height: 52px;
      font-size: 18px;
      font-weight: 820;
      letter-spacing: .2px;
    }
    .homeActions .btn.wide{
      grid-column: 1 / -1;
    }
    .homeActions .btn.tight{
      height: 48px;
      font-size: 16px;
      font-weight: 820;
    }
    .homeActions .btn.exitSmall{
      background: linear-gradient(180deg, rgba(255,80,80,.18), rgba(255,80,80,.10));
      border-color: rgba(255,120,120,.42);
      color: rgba(255,225,225,.92);
      box-shadow: 0 10px 26px rgba(0,0,0,.22);
    }

    /* Make install/uninstall span full panel width */
    #btnInstall{
      grid-column: 1 / -1;
    }

    /* Modal */
    .modal{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: max(16px, env(safe-area-inset-top)) 14px max(16px, env(safe-area-inset-bottom));
      background: rgba(0,0,0,.56);
      z-index: 9998;
      touch-action: none;
    }
    .modalCard{
      width:min(520px, 100%);
      border-radius: 26px;
      border: 3px solid var(--accentBorder);
      background: linear-gradient(180deg, rgba(12,21,40,.96), rgba(8,16,31,.96));
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      padding: 16px;
      backdrop-filter: blur(10px);
      max-height: calc(100vh - 60px);
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .modalTitle{
      font-weight: 900;
      letter-spacing: .2px;
      color: rgba(235,245,255,.92);
      font-size: clamp(22px, 6.5vw, 34px);
      line-height: 1.05;
      margin: 4px 2px 10px;
    }
    .modalSub{
      color: rgba(235,245,255,.72);
      font-size: 15px;
      margin: 0 2px 12px;
      white-space: pre-wrap;
      line-height: 1.28;
    }
    .modalBtns{
      display:flex;
      gap:12px;
      margin-top: 10px;
      flex-wrap:wrap;
    }
    .modalBtns .btn{
      flex:1;
      height: 54px;
      font-size: 18px;
      font-weight: 800;
      min-width: 140px;
    }

    .xCloseRow{
      display:flex;
      justify-content:flex-end;
      margin: -6px -6px 6px;
    }
    .xBtn{
      width:44px; height:44px;
      border-radius: 14px;
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.03);
      color: rgba(235,245,255,.82);
      font-weight: 900;
      font-size: 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .addedBigNum{
      font-size: 34px;
      font-weight: 950;
      letter-spacing: .5px;
      margin: 6px 2px 6px;
      color: rgba(235,245,255,.92);
    }
    .addedMeta{
      color: rgba(235,245,255,.70);
      font-size: 14px;
      margin: 0 2px 10px;
    }
    .addedNotesBox{
      border:1px solid rgba(235,245,255,.12);
      background: rgba(255,255,255,.03);
      border-radius: 18px;
      padding: 12px;
      color: rgba(235,245,255,.84);
      font-size: 16px;
      line-height: 1.25;
      white-space: pre-wrap;
      margin: 10px 0 4px;
    }
    .addedNotesLabel{
      margin: 0 2px 6px;
      color: rgba(235,245,255,.55);
      font-size: 13px;
      font-weight: 850;
      letter-spacing: .2px;
    }

    .touchLock{
      position:fixed;
      inset:0;
      z-index: 9997;
      background: transparent;
      pointer-events:none;
    }
    .touchLock.on{ pointer-events:auto; }

    /* Calendar */
    #calendar{
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-y;
      overscroll-behavior: contain;
    }

    .calBar{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top: 10px;
      flex-wrap:nowrap;
    }
    .calBar .field{ height:52px; border-radius: 18px; }
    .calBar .btn.small{ height:52px; border-radius: 18px; }

    .calGrid{
      margin-top: 12px;
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      width:100%;
    }
    .calDow{
      text-align:center;
      font-size: 12px;
      color: rgba(235,245,255,.54);
      font-weight: 800;
      letter-spacing:.2px;
      padding: 2px 0 4px;
      user-select:none;
    }

    .calCell{
      border:1px solid rgba(235,245,255,.10);
      background: rgba(255,255,255,.02);
      border-radius: 16px;
      min-height: 56px;
      padding: 8px 8px 6px;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      gap:6px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .calCell .dnum{
      font-weight: 900;
      font-size: 14px;
      color: rgba(235,245,255,.76);
      line-height: 1;
    }
    .calCell.hasData{
      border-color: rgba(90,150,255,.45);
      background: rgba(43,78,122,.22);
      box-shadow: 0 12px 24px rgba(0,0,0,.18);
    }
    .calCell.outMonth{ opacity:.42; }

    .calHint{
      margin-top:10px;
      font-size: 13px;
      color: rgba(235,245,255,.44);
    }

    .dayLogoRow{
      display:flex;
      justify-content:center;
      margin: 2px 0 6px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .dayLogoRow svg{
      width: 92%;
      height: auto;
      max-width: 420px;
      opacity: .96;
      filter: drop-shadow(0 10px 22px rgba(0,0,0,.35));
    }
    .dayList{
      border:1px solid rgba(235,245,255,.10);
      background: rgba(255,255,255,.02);
      border-radius: 18px;
      overflow:hidden;
    }
    .dayItem{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 12px;
      border-top:1px solid rgba(235,245,255,.08);
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      cursor:pointer;
    }
    .dayItem:first-child{ border-top:none; }
    .dayItem:active{ transform: translateY(1px); }
    .dayLeft{
      display:flex;
      align-items:baseline;
      gap:10px;
      min-width:0;
    }
    .dayTime{
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.2px;
      color: rgba(235,245,255,.62);
      white-space:nowrap;
    }
    .dayNum{
      font-size: 16px;
      font-weight: 950;
      color: rgba(235,245,255,.90);
      white-space:nowrap;
    }
    .dayNotes{
      margin-left:auto;
      font-size: 12px;
      color: rgba(235,245,255,.48);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 45%;
    }
    .chev{
      font-size: 16px;
      font-weight: 900;
      color: rgba(235,245,255,.55);
      margin-left: 10px;
      flex:0 0 auto;
    }

    .detailsToggleRow{
      display:flex;
      justify-content:flex-start;
      margin-top: 10px;
    }
    .detailsToggleRow .btn{
      height: 46px;
      font-size: 16px;
      font-weight: 850;
      padding: 0 16px;
      min-width: 0;
      flex: 0 0 auto;
      border-radius: 18px;
    }
    .detailsBox{
      margin-top: 10px;
      border: 1px solid rgba(235,245,255,.10);
      background: rgba(255,255,255,.02);
      border-radius: 18px;
      padding: 10px;
    }

    /* Export report card */
    .reportBox{
      border: 2px solid rgba(90,150,255,.40);
      background: rgba(0,0,0,.10);
      border-radius: 18px;
      padding: 12px;
      white-space: pre-wrap;
      line-height: 1.35;
      color: rgba(235,245,255,.88);
      font-size: 14px;
      max-height: 46vh;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      box-shadow: 0 14px 34px rgba(0,0,0,.22);
    }
    .reportHintRow{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-top: 10px;
      color: rgba(235,245,255,.52);
      font-size: 12px;
      user-select:none;
    }

    #exportModal{ z-index: 10020; }
  </style>
</head>
<body>
  <div class="touchLock" id="touchLock"></div>

  <div class="app" id="appRoot">
    <div class="logoTitle" aria-label="Angel Code">
      <svg viewBox="0 0 900 140" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Angel Code">
        <defs>
          <linearGradient id="angG" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0%" stop-color="#8a6bff"/>
            <stop offset="55%" stop-color="#4fa3ff"/>
            <stop offset="100%" stop-color="#2f78ff"/>
          </linearGradient>
          <filter id="angS" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="0" dy="8" stdDeviation="8" flood-color="rgba(0,0,0,.35)"/>
          </filter>
        </defs>
        <g transform="translate(46 24)" filter="url(#angS)">
          <rect x="0" y="0" width="92" height="92" rx="26" fill="rgba(255,255,255,.06)" stroke="rgba(235,245,255,.22)" stroke-width="2"/>
          <ellipse cx="46" cy="24" rx="20" ry="8" fill="none" stroke="rgba(235,245,255,.88)" stroke-width="4" opacity=".92"/>
          <path d="M46 50
                   C34 42, 22 44, 16 54
                   C24 58, 32 66, 38 76
                   C40 66, 43 58, 46 50Z"
                fill="none" stroke="url(#angG)" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M46 50
                   C58 42, 70 44, 76 54
                   C68 58, 60 66, 54 76
                   C52 66, 49 58, 46 50Z"
                fill="none" stroke="url(#angG)" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M46 34 L46 42" stroke="rgba(235,245,255,.82)" stroke-width="4" stroke-linecap="round"/>
          <path d="42 38 L50 38" stroke="rgba(235,245,255,.82)" stroke-width="4" stroke-linecap="round"/>
        </g>

        <text x="160" y="92"
              font-family="system-ui,Segoe UI,Roboto,Helvetica,Arial"
              font-size="66"
              font-weight="860"
              fill="url(#angG)"
              letter-spacing=".6"
              filter="url(#angS)">Angel Code</text>
      </svg>
      <div class="tinyVer" id="tinyVer">v—</div>
    </div>

    <div class="screenArea" id="screenArea">
      <div class="ptr" id="ptr">
        <div class="ptrDot"></div>
        <div class="ptrHint" id="ptrHint">Pull to refresh</div>
        <div class="ptrSmall" id="ptrSmall"></div>
      </div>

      <div class="deck" id="deck">
        <!-- HOME -->
        <div id="home" class="card">
          <div id="homeScroll">
            <div class="homeShell" id="homeShell">
              <div class="homeTopRow">
                <input id="homeIdNum" class="field" inputmode="numeric"
                       autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"
                       placeholder="Enter a number (example: 1111, 1212, 1234)" />
                <button id="btnHomeSubmit" class="btn primary">Submit</button>
              </div>

              <div id="bigInstallWrap" class="bigInstallWrap hidden">
                <button id="btnBigInstall" class="btn bigInstallBtn">Install Angel Code</button>
              </div>

              <div class="homeInstrOneLine" id="homeInstrLine">
                Swipe left to view Calendar.
              </div>

              <div id="homeAfterSubmit" class="hidden">
                <div class="meaningCard" id="homeMeaningCard">
                  <div class="angelCardFrame" id="homeAngelFrame">
                    <div id="homeAngelHeader" class="angelHeaderLine">Angel Card Number: —</div>
                    <div id="homeAngelBigNum" class="angelBigNum">—</div>
                    <div id="homeMeta" class="metaScroll">—</div>
                  </div>

                  <div class="disclaimer">
                    Cultural note: these meanings come from numerology/“angel number” traditions and can vary.
                    Use them as gentle prompts for reflection, not as facts or predictions.
                  </div>
                </div>

                <div class="subtle">Inspired by a real Angel.</div>
                <div class="subtle">Local-only. No accounts. No cloud.</div>

                <div class="homeActions">
                  <button id="btnAddToCalendar" class="btn primary wide">Add to Calendar</button>
                  <button id="btnViewCalendar" class="btn">View Calendar</button>
                  <button id="btnInstall" class="btn">Install</button>
                  <button id="btnHomeExport" class="btn tight">Export</button>
                  <button id="btnExitHome" class="btn tight exitSmall">Exit</button>
                </div>

                <div class="footerTiny">
                  <div id="homeVerLabel" aria-label="Version label">v—</div>
                  <div>developed by Keyth Jyles</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- CALENDAR -->
        <div id="calendar" class="card">
          <div class="calBar">
            <input id="calMonth" class="field" type="month" />
            <button id="btnCalAddNew" class="btn small primary">Add</button>
            <button id="btnBackFromCalendar" class="btn small">Back</button>
          </div>

          <div class="calHint">Swipe right for Home.</div>

          <div class="calGrid" id="calDowRow"></div>
          <div class="calGrid" id="calGrid"></div>
          <div class="calHint">Tap a highlighted day to view entries.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Info modal -->
  <div id="infoModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="infoTitle">
    <div class="modalCard">
      <div class="xCloseRow">
        <button class="xBtn" id="btnInfoX" aria-label="Close">×</button>
      </div>
      <div class="modalTitle" id="infoTitle">Info</div>
      <div class="modalSub" id="infoSub">—</div>

      <div id="addedBlock" class="hidden">
        <div class="addedBigNum" id="addedBigNum">—</div>
        <div class="addedMeta" id="addedMeta">—</div>
        <div class="addedNotesLabel" id="addedNotesLabel">Notes</div>
        <div class="addedNotesBox" id="addedNotesBox">None</div>
      </div>

      <div class="modalBtns">
        <button id="btnInfoOk" class="btn primary">OK</button>
      </div>
    </div>
  </div>

  <!-- Export (Readable Report) modal -->
  <div id="exportModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="exportModalTitle">
    <div class="modalCard">
      <div class="modalTitle" id="exportModalTitle">Export</div>
      <div class="modalSub" id="exportModalSub">Your report is shown below.</div>

      <div id="exportReportBox" class="reportBox">—</div>
      <div class="reportHintRow">
        <div id="exportHintLeft">Local-only report.</div>
        <div id="exportHintRight">Copy / Share / Save</div>
      </div>

      <div class="modalBtns" style="margin-top:12px;">
        <button id="btnExportOk" class="btn primary">OK</button>
        <button id="btnExportCopy" class="btn">Copy</button>
        <button id="btnExportShare" class="btn">Share</button>
        <button id="btnExportSave" class="btn">Save .txt</button>
      </div>
    </div>
  </div>

  <!-- Add-to-Calendar modal (from Home) -->
  <div id="addCalModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="addCalTitle">
    <div class="modalCard">
      <div class="xCloseRow">
        <button class="xBtn" id="btnAddCalX" aria-label="Close">×</button>
      </div>
      <div class="modalTitle" id="addCalTitle">Add to Calendar</div>
      <div class="modalSub" id="addCalSub">This saves an entry to your calendar on this device.</div>

      <div class="label" style="margin-top:6px;">Date &amp; time</div>
      <input id="addCalDT" class="field" type="datetime-local" />

      <div class="label">Number</div>
      <div id="addCalNumber" class="field" style="display:flex; align-items:center; font-weight:900;">—</div>

      <div class="label">Notes (optional)</div>
      <textarea id="addCalNotes" class="field" style="font-size:18px;" placeholder="Where did you see it? What was happening?"></textarea>

      <div class="modalBtns">
        <button id="btnAddCalAdd" class="btn primary">Add</button>
        <button id="btnAddCalCancel" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- NEW Sighting modal (from Calendar) -->
  <div id="newSightingModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="newSightingTitle">
    <div class="modalCard">
      <div class="xCloseRow">
        <button class="xBtn" id="btnNewSightingX" aria-label="Close">×</button>
      </div>
      <div class="modalTitle" id="newSightingTitle">New Sighting</div>
      <div class="modalSub" id="newSightingSub">Add a new angel number sighting to your calendar.</div>

      <div class="label" style="margin-top:6px;">Date &amp; time</div>
      <input id="newSightingDT" class="field" type="datetime-local" />

      <div class="label">Number</div>
      <input id="newSightingNum" class="field" inputmode="numeric" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="e.g., 1111" />

      <div class="label">Notes (optional)</div>
      <textarea id="newSightingNotes" class="field" style="font-size:18px;" placeholder="Where did you see it? What was happening?"></textarea>

      <div class="modalBtns">
        <button id="btnNewSightingAdd" class="btn primary">Add</button>
        <button id="btnNewSightingCancel" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Day list modal (NO X) -->
  <div id="dayListModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="dayListTitle">
    <div class="modalCard">
      <div class="dayLogoRow" aria-hidden="true" id="dayLogoRow"></div>
      <div class="modalTitle" id="dayListTitle">Day</div>
      <div class="modalSub" id="dayListSub">Tap a number to view details.</div>

      <div class="dayList" id="dayList"></div>

      <div class="modalBtns">
        <button id="btnDayListClose" class="btn primary">Close</button>
      </div>
    </div>
  </div>

  <!-- View & Update (Angel Card) modal -->
  <div id="editModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="editTitle">
    <div class="modalCard">
      <div class="modalTitle" id="editTitle">View &amp; Update</div>
      <div class="modalSub" id="editSub">Angel Card first. Entry details are below.</div>

      <div class="angelCardFrame">
        <div id="editAngelHeader" class="angelHeaderLine">Angel Card Number: —</div>
        <div id="editAngelBig" class="angelBigNum">—</div>
        <div id="editAngelCard" class="metaScroll" style="max-height: 185px; margin-top:0;">—</div>
      </div>

      <div class="detailsToggleRow">
        <button id="btnToggleDetails" class="btn">View/Edit Details</button>
      </div>

      <div id="editDetailsBox" class="detailsBox hidden">
        <div class="label" style="margin-top:2px;">Date &amp; time</div>
        <input id="editDT" class="field" type="datetime-local" />

        <div class="label">Number</div>
        <input id="editNum" class="field" inputmode="numeric" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="e.g., 1111" />

        <div class="label">Notes (saved with entry)</div>
        <textarea id="editNotes" class="field" style="font-size:18px;" placeholder="Notes..."></textarea>

        <div class="label">Pattern</div>
        <div id="editPattern" class="field" style="display:flex; align-items:center; font-weight:900; color: rgba(235,245,255,.84);">—</div>
      </div>

      <div class="modalBtns">
        <button id="btnEditSave" class="btn primary">Save</button>
        <button id="btnEditExport" class="btn">Export</button>
        <button id="btnEditDelete" class="btn danger">Delete</button>
        <button id="btnEditClose" class="btn">Close</button>
      </div>
    </div>
  </div>

  <script>
(() => {
  "use strict";

  const APP_VERSION = "v1.2A13";
  const STORAGE_KEY = "angel_numbers_records_v2_2025_12_29"; // keep existing data
  const DAY_MS = 24*60*60*1000;
  const $ = (id) => document.getElementById(id);

  function isStandalone(){
    try{
      if(window.matchMedia && window.matchMedia("(display-mode: standalone)").matches) return true;
      if(window.navigator && "standalone" in window.navigator && window.navigator.standalone) return true;
    }catch{}
    return false;
  }

  let deferredInstallPrompt = null;
  let bigInstallSuppressed = false; // if an Export report is displayed, suppress big install until refresh

  window.addEventListener("beforeinstallprompt", (e) => {
    e.preventDefault();
    deferredInstallPrompt = e;
    updateInstallButton();
    updateBigInstallVisibility();
  });

  window.addEventListener("appinstalled", () => {
    deferredInstallPrompt = null;
    updateInstallButton(true);
    updateBigInstallVisibility();
  });

  async function tryInstall(){
    if(!deferredInstallPrompt){
      openInfo("Install", "Install is only available when your browser offers it.\n\nTip: In Chrome, use menu ⋮ → Install app (if shown).", {mode:"info"});
      return false;
    }
    try{
      deferredInstallPrompt.prompt();
      await deferredInstallPrompt.userChoice;
    }catch{}
    deferredInstallPrompt = null;
    updateInstallButton();
    updateBigInstallVisibility();
    return true;
  }

  function closeAttempt(){
    window.close();
    setTimeout(() => {
      alert("If it didn’t close: use your phone’s Back/Home.");
    }, 220);
  }

  function openUninstallAndClose(){
    const msg =
      "To uninstall the app:\n\n" +
      "Android:\n" +
      "• Long-press the app icon → Uninstall\n" +
      "or\n" +
      "• Settings → Apps → Angel Code → Uninstall\n\n" +
      "iPhone/iPad:\n" +
      "• Long-press the app icon → Remove App\n\n" +
      "If you installed from Chrome, removing the app icon uninstalls the PWA.";
    openInfo("Uninstall", msg, {mode:"info", closeOnOk:true});
  }

  function updateInstallButton(installedMaybe=false){
    const btn = $("btnInstall");
    if(!btn) return;

    const standaloneNow = installedMaybe || isStandalone();

    // Installed: show Uninstall.
    if(standaloneNow){
      btn.classList.remove("hidden");
      btn.disabled = false;
      btn.textContent = "Uninstall";
      btn.dataset.mode = "uninstall";
      return;
    }

    // Not installed: show ONLY if install prompt is available.
    btn.dataset.mode = "install";
    if(deferredInstallPrompt){
      btn.classList.remove("hidden");
      btn.disabled = false;
      btn.textContent = "Install";
    }else{
      btn.classList.add("hidden");
      btn.disabled = true;
      btn.textContent = "Install";
    }
  }

  function homeAfterSubmitIsVisible(){
    const el = $("homeAfterSubmit");
    if(!el) return false;
    return !el.classList.contains("hidden");
  }

  function updateBigInstallVisibility(){
    const wrap = $("bigInstallWrap");
    if(!wrap) return;

    // Big install ONLY on Entry screen (before Submit reveal).
    if(homeAfterSubmitIsVisible()){ wrap.classList.add("hidden"); return; }

    // If installed, never show.
    if(isStandalone()){ wrap.classList.add("hidden"); return; }

    // If a report has been displayed, suppress until refresh.
    if(bigInstallSuppressed){ wrap.classList.add("hidden"); return; }

    // Only show if install is available.
    if(deferredInstallPrompt){ wrap.classList.remove("hidden"); }
    else{ wrap.classList.add("hidden"); }
  }

  function suppressBigInstallUntilRefresh(){
    bigInstallSuppressed = true;
    updateBigInstallVisibility();
  }

  async function copyToClipboard(text){
    if(navigator.clipboard && navigator.clipboard.writeText){
      await navigator.clipboard.writeText(text);
      return true;
    }
    return false;
  }

  function downloadText(text, filename){
    const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  async function saveTextWithPicker(text, suggestedName){
    const canPick = typeof window.showSaveFilePicker === "function";
    if(!canPick) return false;

    const opts = {
      suggestedName: suggestedName || "angel_code_report.txt",
      types: [{ description: "Text", accept: {"text/plain": [".txt"]} }]
    };

    const handle = await window.showSaveFilePicker(opts);
    const writable = await handle.createWritable();
    await writable.write(new Blob([text], {type:"text/plain;charset=utf-8"}));
    await writable.close();
    return true;
  }

  function isShareAvailable(){
    return !!(navigator.share && typeof navigator.share === "function");
  }

  function loadRecords(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return [];
      const arr = JSON.parse(raw);
      if(!Array.isArray(arr)) return [];
      return arr
        .filter(r => r && typeof r.ts === "number")
        .map(r => ({
          id: (r.id ?? "").toString() || makeId(r.ts),
          ts: r.ts,
          number: (r.number ?? "").toString(),
          pattern: (r.pattern ?? "").toString(),
          meaning: (r.meaning ?? "").toString(),
          notes: (r.notes ?? "").toString()
        }))
        .sort((a,b)=> b.ts - a.ts);
    }catch{
      return [];
    }
  }

  function saveRecords(recs){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(recs));
  }

  function addRecord(rec){
    const recs = loadRecords();
    recs.unshift(rec);
    saveRecords(recs);
  }

  function updateRecordById(id, patch){
    const recs = loadRecords();
    const idx = recs.findIndex(r => r.id === id);
    if(idx < 0) return false;
    recs[idx] = { ...recs[idx], ...patch };
    recs.sort((a,b)=> b.ts - a.ts);
    saveRecords(recs);
    return true;
  }

  function deleteRecordById(id){
    const recs = loadRecords().filter(r => r.id !== id);
    saveRecords(recs);
  }

  function fmtDateTime(ts){
    const d = new Date(ts);
    return new Intl.DateTimeFormat(undefined, {
      year:"numeric", month:"2-digit", day:"2-digit",
      hour:"2-digit", minute:"2-digit", second:"2-digit"
    }).format(d);
  }

  function fmtDayTitle(ts){
    const d = new Date(ts);
    return new Intl.DateTimeFormat(undefined, { weekday:"long", year:"numeric", month:"long", day:"numeric" }).format(d);
  }

  function fmtTimeShort(ts){
    const d = new Date(ts);
    return new Intl.DateTimeFormat(undefined, { hour:"2-digit", minute:"2-digit" }).format(d);
  }

  function startOfDay(ts){
    const d = new Date(ts);
    d.setHours(0,0,0,0);
    return d.getTime();
  }

  function normalizeNumberInput(raw){
    const s = String(raw ?? "").trim();
    return s.replace(/[^\d]/g, "");
  }

  function makeId(seedTs){
    const r = Math.random().toString(16).slice(2);
    return `ac_${seedTs}_${r}`;
  }

  function toDTLocalValue(ts){
    const d = new Date(ts);
    const pad = (n)=>String(n).padStart(2,"0");
    const y = d.getFullYear();
    const m = pad(d.getMonth()+1);
    const da = pad(d.getDate());
    const hh = pad(d.getHours());
    const mi = pad(d.getMinutes());
    return `${y}-${m}-${da}T${hh}:${mi}`;
  }

  function fromDTLocalValue(v){
    const s = String(v || "").trim();
    if(!s) return null;
    const d = new Date(s);
    const t = d.getTime();
    return Number.isFinite(t) ? t : null;
  }

  function isAllSame(s){ return !!(s && s.length >= 2 && s.split("").every(ch => ch === s[0])); }
  function isPalindrome(s){ if(!s || s.length < 3) return false; return s === s.split("").reverse().join(""); }
  function isRepeatedHalf(s){ if(!s || s.length < 4 || s.length % 2) return false; const h=s.slice(0,s.length/2); return h+h===s; }
  function isAscendingSeq(s){
    if(!s || s.length < 3) return false;
    for(let i=1;i<s.length;i++){
      const a=s.charCodeAt(i-1)-48, b=s.charCodeAt(i)-48;
      if(b !== a+1) return false;
    }
    return true;
  }
  function isDescendingSeq(s){
    if(!s || s.length < 3) return false;
    for(let i=1;i<s.length;i++){
      const a=s.charCodeAt(i-1)-48, b=s.charCodeAt(i)-48;
      if(b !== a-1) return false;
    }
    return true;
  }

  function detectPattern(s){
    if(!s) return "—";
    if(isAllSame(s)) return `Repeating ${s[0]}s`;
    if(isAscendingSeq(s)) return "Counting up (in order)";
    if(isDescendingSeq(s)) return "Counting down (in order)";
    if(isRepeatedHalf(s)) return "Repeat pattern (double)";
    if(isPalindrome(s)) return "Mirror pattern";
    if(s.length === 3 && s[0] === s[2] && s[0] !== s[1]) return "Sandwich pattern";
    return "Mixed pattern";
  }

  const DIGIT_ARCHETYPES = {
    "0": { core: "Fresh start • reset • open possibilities", strengths: ["starting over","clearing clutter","seeing the big picture"], cautions: ["don’t drift","pick one next step"], prompts: ["What needs a reset?","What would a clean start look like?","What is the simplest next step?"] },
    "1": { core: "New beginnings • focus • personal strength", strengths: ["clarity","confidence","taking the lead"], cautions: ["don’t rush","don’t let pride decide"], prompts: ["What do you want to begin?","What deserves your focus today?","What one thing matters most?"] },
    "2": { core: "Balance • teamwork • patience", strengths: ["calm","cooperation","listening"], cautions: ["don’t get stuck","don’t over-please"], prompts: ["Where do you need balance?","Who can you work with?","What conversation needs clarity?"] },
    "3": { core: "Expression • creativity • encouragement", strengths: ["communication","optimism","creative momentum"], cautions: ["don’t scatter your energy","don’t overcommit"], prompts: ["What needs to be said?","What can you create today?","Where can you bring more joy?"] },
    "4": { core: "Stability • structure • discipline", strengths: ["planning","reliability","building foundations"], cautions: ["don’t be too rigid","avoid over-control"], prompts: ["What routine would help?","What needs strengthening?","What are you building long-term?"] },
    "5": { core: "Change • flexibility • learning by doing", strengths: ["adaptability","growth","forward motion"], cautions: ["avoid chaos","don’t act on impulse"], prompts: ["What is changing?","What can you let go of?","What new option is opening?"] },
    "6": { core: "Care • home • responsibility", strengths: ["supporting others","healing","protecting what matters"], cautions: ["avoid carrying everything","avoid guilt decisions"], prompts: ["What needs care right now?","What boundary would help?","What truly matters today?"] },
    "7": { core: "Inner wisdom • insight • reflection", strengths: ["discernment","depth","learning"], cautions: ["don’t isolate too much","avoid overthinking"], prompts: ["What do you know inside?","What needs research?","What truth needs quiet time?"] },
    "8": { core: "Practical success • power • money/work lessons", strengths: ["execution","leadership","results"], cautions: ["avoid control battles","don’t tie worth to outcomes"], prompts: ["What are you responsible for?","Where do you need strength?","What practical move helps most?"] },
    "9": { core: "Completion • forgiveness • letting go", strengths: ["closure","compassion","wisdom from endings"], cautions: ["don’t cling to the past","avoid self-sacrifice"], prompts: ["What needs closure?","What lesson is complete?","What can you release with peace?"] }
  };

  const ANGEL_MAP = {
    "000":"Reset and begin again. A clean-slate moment—breathe, clear your head, and choose a new direction.",
    "111":"Focus your thoughts. What you keep thinking about is what you feed—aim your attention on what you want to build.",
    "222":"Balance and patience. Let things settle; work with others and keep the peace where you can.",
    "333":"Speak up and create. Express yourself; your voice and ideas matter right now.",
    "444":"Build your foundation. Stay steady, stay disciplined—this is about structure and stability.",
    "555":"Change is moving. Adjust, stay flexible, and step forward instead of freezing.",
    "666":"Re-center your priorities. Come back to health, home, and what truly matters.",
    "777":"Trust your inner guidance. Slow down and listen; learn, reflect, and follow what feels true.",
    "888":"Strong momentum. Practical progress—take smart action and manage your resources well.",
    "999":"A chapter is closing. Wrap things up, forgive, and make room for what’s next.",
    "1010":"A fresh cycle with direction. Start clean and stay intentional.",
    "1111":"Heightened awareness. Notice what you’re thinking and choosing—align with your best path.",
    "1212":"Realignment and growth. Keep going; small steady steps add up.",
    "1234":"Step-by-step progress. Keep it simple; do the next right thing."
  };

  function digitSumSteps(n){
    const digits = n.split("").map(ch => ch.charCodeAt(0)-48).filter(x => x>=0 && x<=9);
    const sum = digits.reduce((a,b)=>a+b,0);

    let root = 0;
    if(digits.length && digits.every(x=>x===0)){
      root = 0;
    }else if(sum > 0){
      root = ((sum - 1) % 9) + 1;
    }else{
      root = 0;
    }

    const stepStr = `${digits.join(" + ")} = ${sum} → ${root}`;
    return { digits, sum, root, stepStr };
  }

  function dominantDigits(n){
    const counts = {};
    for(const ch of n){
      counts[ch] = (counts[ch]||0) + 1;
    }
    const entries = Object.entries(counts).sort((a,b)=> b[1]-a[1] || (a[0] > b[0] ? 1 : -1));
    return entries.map(([d,c]) => ({ d, c }));
  }

  function listBullets(items){
    return items.map(x => `• ${x}`).join("\n");
  }

  function buildAngelCard(n){
    if(!n){
      return { pattern: "—", headline: "—", cardText: "—" };
    }

    const pattern = detectPattern(n);
    const steps = digitSumSteps(n);
    const rootDigit = String(steps.root);

    const dom = dominantDigits(n);
    const domTop = dom[0]?.d ?? rootDigit;

    const rootA = DIGIT_ARCHETYPES[rootDigit] || null;
    const domA = DIGIT_ARCHETYPES[domTop] || null;

    const mapped = ANGEL_MAP[n] || "";
    const mainTheme = rootA ? rootA.core : `Theme: ${rootDigit}`;
    const headline = mapped ? mapped : `Main theme: ${mainTheme}.`;

    let patternLens = "";
    if(pattern === "Counting up (in order)") patternLens = "Pattern note: it looks like a step-by-step climb. Keep it simple and keep moving.";
    else if(pattern === "Counting down (in order)") patternLens = "Pattern note: it looks like simplifying. Let go of extra weight and return to basics.";
    else if(pattern === "Repeat pattern (double)"){
      const half = n.slice(0, n.length/2);
      patternLens = `Pattern note: "${half}" repeats. When something repeats, it’s asking for extra attention.`;
    } else if(pattern === "Mirror pattern") {
      patternLens = "Pattern note: it mirrors itself. Consider what life is reflecting back to you right now.";
    } else if(/^Repeating/.test(pattern)) {
      patternLens = "Pattern note: repeating digits turn up the volume on the main theme.";
    } else if(pattern === "Sandwich pattern") {
      patternLens = "Pattern note: the outer digits ‘frame’ the middle digit. Notice what the middle might represent in your situation.";
    } else {
      patternLens = "Pattern note: a mix. Use the main theme plus what was happening when you noticed the number.";
    }

    const domDesc = dom.map(x => `${x.d}×${x.c}`).join("  |  ");

    const prompts = [];
    if(rootA?.prompts?.length) prompts.push(...rootA.prompts);
    if(domA?.prompts?.length && domTop !== rootDigit) prompts.push(...domA.prompts);
    const promptsUnique = [...new Set(prompts)].slice(0, 6);

    const strengths = [];
    const cautions = [];
    if(rootA?.strengths?.length) strengths.push(...rootA.strengths);
    if(domA?.strengths?.length && domTop !== rootDigit) strengths.push(...domA.strengths);
    if(rootA?.cautions?.length) cautions.push(...rootA.cautions);
    if(domA?.cautions?.length && domTop !== rootDigit) cautions.push(...domA.cautions);

    const strengthsUnique = [...new Set(strengths)].slice(0, 6);
    const cautionsUnique = [...new Set(cautions)].slice(0, 6);

    const lines = [];
    lines.push("Overview");
    lines.push(`Main theme: ${mapped ? mapped : mainTheme}.`);
    lines.push("");
    lines.push("Why this pattern matters");
    lines.push(patternLens);
    lines.push("");
    lines.push("Simple number lens (digit-sum)");
    lines.push(`Add the digits: ${steps.stepStr}`);
    lines.push(`Main theme digit: ${mainTheme}`);
    lines.push("");
    lines.push("Digit emphasis");
    lines.push(`What shows up most: ${domDesc}`);
    lines.push("");

    if(strengthsUnique.length){
      lines.push("Helpful qualities");
      lines.push(listBullets(strengthsUnique));
      lines.push("");
    }
    if(cautionsUnique.length){
      lines.push("Watch-outs");
      lines.push(listBullets(cautionsUnique));
      lines.push("");
    }
    if(promptsUnique.length){
      lines.push("Questions you can ask yourself");
      lines.push(listBullets(promptsUnique));
      lines.push("");
    }

    lines.push("Quick way to use this");
    lines.push("• Think back to what you were doing or thinking when you saw the number.");
    lines.push("• Read the main theme as a gentle prompt.");
    lines.push("• Take one small step that matches the theme.");

    return { pattern, headline, cardText: lines.join("\n") };
  }

  // -------------------------
  // UI state
  // -------------------------
  const state = {
    activePanel: 0, // 0 home, 1 calendar
    selectedId: null,
    lastCardNumber: "",
    lastCard: null
  };

  function setVersionLabels(){
    $("tinyVer").textContent = APP_VERSION;
    $("homeVerLabel").textContent = APP_VERSION;
  }

  // -------------------------
  // Modal helpers
  // -------------------------
  function show(el){ el.classList.remove("hidden"); }
  function hide(el){ el.classList.add("hidden"); }

  function openInfo(title, msg, opts={}){
    $("infoTitle").textContent = title || "Info";
    $("infoSub").textContent = msg || "";
    hide($("addedBlock"));
    show($("infoModal"));
    lockTouch(true);

    const closeOnOk = !!opts.closeOnOk;

    const ok = $("btnInfoOk");
    const x = $("btnInfoX");

    const handler = () => {
      closeInfo();
      if(closeOnOk) closeAttempt();
    };

    ok.onclick = handler;
    x.onclick = handler;
  }

  function closeInfo(){
    hide($("infoModal"));
    lockTouch(false);
  }

  function lockTouch(on){
    const tl = $("touchLock");
    if(on) tl.classList.add("on");
    else tl.classList.remove("on");
  }

  // -------------------------
  // Export modal
  // -------------------------
  let currentExportText = "";

  function openExport(text){
    currentExportText = text || "";
    $("exportReportBox").textContent = currentExportText || "—";
    show($("exportModal"));
    lockTouch(true);

    // Once a report is displayed, suppress big install until refresh.
    suppressBigInstallUntilRefresh();
  }

  function closeExport(){
    hide($("exportModal"));
    lockTouch(false);
  }

  function buildReportAllRecords(title, recs){
    const now = new Date();
    const header =
`Angel Code — Export Report
App Version: ${APP_VERSION}
Report: ${title}
Generated: ${new Intl.DateTimeFormat(undefined, {year:"numeric",month:"2-digit",day:"2-digit"}).format(now)} ${new Intl.DateTimeFormat(undefined, {hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(now)}
Storage: Local-only (this device)

How this data was captured:
- Sightings are entered manually in Angel Code on this device.
- Data is stored locally on the phone (no cloud sync, no account).
- Each record may include the number, pattern, an angel-card style interpretation, and optional notes.

------------------------------`;

    if(!recs.length){
      return header + "\n(No records found.)\n";
    }

    const lines = [header];
    for(const r of recs.slice().sort((a,b)=>b.ts-a.ts)){
      lines.push(`${fmtDateTime(r.ts)}`);
      lines.push(`Number: ${r.number || "—"}`);
      lines.push(`Pattern: ${r.pattern || "—"}`);
      lines.push(`Meaning: ${(r.meaning || "").trim() || "—"}`);
      lines.push(`Notes: ${(r.notes || "").trim() || "—"}`);
      lines.push("");
    }
    return lines.join("\n");
  }

  // -------------------------
  // Navigation (swipe deck)
  // -------------------------
  const deck = $("deck");
  const screenArea = $("screenArea");
  let drag = {active:false, startX:0, startY:0, baseX:0, lastX:0, lastT:0, moved:false};

  function setPanel(idx, animate=true){
    state.activePanel = Math.max(0, Math.min(1, idx));
    if(animate) deck.classList.add("anim");
    else deck.classList.remove("anim");
    const tx = state.activePanel === 0 ? 0 : -50;
    deck.style.transform = `translate3d(${tx}%,0,0)`;
    if(animate) setTimeout(()=>deck.classList.remove("anim"), 300);
  }

  function onPointerDown(e){
    if($("infoModal").classList.contains("hidden") === false) return;
    if($("exportModal").classList.contains("hidden") === false) return;
    if($("addCalModal").classList.contains("hidden") === false) return;
    if($("newSightingModal").classList.contains("hidden") === false) return;
    if($("dayListModal").classList.contains("hidden") === false) return;
    if($("editModal").classList.contains("hidden") === false) return;

    drag.active = true;
    drag.moved = false;
    drag.startX = e.clientX;
    drag.startY = e.clientY;
    drag.baseX = state.activePanel === 0 ? 0 : -50;
    drag.lastX = e.clientX;
    drag.lastT = performance.now();
    deck.classList.remove("anim");
  }

  function onPointerMove(e){
    if(!drag.active) return;
    const dx = e.clientX - drag.startX;
    const dy = e.clientY - drag.startY;

    // Only engage horizontal swipe if mostly horizontal
    if(!drag.moved){
      if(Math.abs(dx) < 8) return;
      if(Math.abs(dy) > Math.abs(dx) * 1.2){
        drag.active = false;
        return;
      }
      drag.moved = true;
    }

    e.preventDefault();
    const pct = (dx / screenArea.clientWidth) * 100;
    let tx = drag.baseX + pct;
    tx = Math.max(-50, Math.min(0, tx));
    deck.style.transform = `translate3d(${tx}%,0,0)`;
    drag.lastX = e.clientX;
    drag.lastT = performance.now();
  }

  function onPointerUp(e){
    if(!drag.active) return;
    drag.active = false;
    if(!drag.moved) return;

    const dx = e.clientX - drag.startX;
    const pct = (dx / screenArea.clientWidth) * 100;
    const currentTx = (state.activePanel === 0 ? 0 : -50) + pct;

    // Snap threshold
    if(state.activePanel === 0){
      if(currentTx < -18) setPanel(1, true);
      else setPanel(0, true);
    }else{
      if(currentTx > -32) setPanel(0, true);
      else setPanel(1, true);
    }
  }

  screenArea.addEventListener("pointerdown", onPointerDown, {passive:false});
  screenArea.addEventListener("pointermove", onPointerMove, {passive:false});
  screenArea.addEventListener("pointerup", onPointerUp, {passive:true});
  screenArea.addEventListener("pointercancel", onPointerUp, {passive:true});

  // -------------------------
  // Pull-to-refresh (simple)
  // -------------------------
  const ptr = $("ptr");
  const ptrSmall = $("ptrSmall");
  const homeScroll = $("homeScroll");
  const calendarScroll = $("calendar");

  function setupPTR(scroller){
    let startY = 0;
    let pulling = false;
    let armed = false;

    scroller.addEventListener("touchstart", (e) => {
      if(scroller.scrollTop > 0) return;
      if(state.activePanel !== (scroller === homeScroll ? 0 : 1)) return;
      startY = e.touches[0].clientY;
      pulling = true;
      armed = false;
      ptrSmall.textContent = "";
    }, {passive:true});

    scroller.addEventListener("touchmove", (e) => {
      if(!pulling) return;
      if(scroller.scrollTop > 0){ pulling = false; hide(ptr); return; }
      const y = e.touches[0].clientY;
      const dy = y - startY;
      if(dy < 0){ hide(ptr); return; }
      if(dy > 8){
        show(ptr);
        const amt = Math.min(60, dy);
        ptr.style.transform = `translateX(-50%) translateY(${amt/4}px)`;
        armed = dy > 80;
        ptrSmall.textContent = armed ? "Release" : "";
      }
    }, {passive:true});

    scroller.addEventListener("touchend", () => {
      if(!pulling) return;
      pulling = false;
      ptr.style.transform = `translateX(-50%)`;
      hide(ptr);
      if(armed){
        location.reload();
      }
    }, {passive:true});
  }

  setupPTR(homeScroll);
  setupPTR(calendarScroll);

  // -------------------------
  // Home: submit + card render
  // -------------------------
  function revealAfterSubmit(){
    show($("homeAfterSubmit"));
    updateBigInstallVisibility(); // should hide big install now (entry-only)
  }

  function renderCardToHome(numberStr){
    const n = normalizeNumberInput(numberStr);
    if(!n){
      openInfo("Number required", "Enter a number first.", {mode:"info"});
      return;
    }

    const card = buildAngelCard(n);
    state.lastCardNumber = n;
    state.lastCard = card;

    $("homeAngelHeader").textContent = `Angel Card Number: ${n}`;
    $("homeAngelBigNum").textContent = n;
    $("homeMeta").textContent = card.cardText;
    revealAfterSubmit();

    // ensure install button state updated after submit (installed/uninstalled/availability)
    updateInstallButton();
  }

  // -------------------------
  // Calendar rendering
  // -------------------------
  const DOW = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

  function ensureDowRow(){
    const row = $("calDowRow");
    if(row.childElementCount) return;
    for(const d of DOW){
      const div = document.createElement("div");
      div.className = "calDow";
      div.textContent = d;
      row.appendChild(div);
    }
  }

  function ymd(d){
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const da = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${da}`;
  }

  function getMonthMeta(yyyy_mm){
    const [yS, mS] = yyyy_mm.split("-");
    const y = Number(yS);
    const m = Number(mS) - 1;
    const first = new Date(y, m, 1);
    const startDow = first.getDay();
    const gridStart = new Date(y, m, 1 - startDow);
    const days = [];
    for(let i=0;i<42;i++){
      const d = new Date(gridStart.getFullYear(), gridStart.getMonth(), gridStart.getDate()+i);
      days.push(d);
    }
    return {y, m, first, gridStart, days};
  }

  function dayHasDataMap(){
    const recs = loadRecords();
    const map = new Map();
    for(const r of recs){
      const k = ymd(new Date(startOfDay(r.ts)));
      map.set(k, (map.get(k)||0) + 1);
    }
    return map;
  }

  function renderCalendar(){
    ensureDowRow();
    const monthVal = $("calMonth").value;
    if(!monthVal) return;

    const grid = $("calGrid");
    grid.innerHTML = "";

    const {y, m, days} = getMonthMeta(monthVal);
    const map = dayHasDataMap();

    for(const d of days){
      const cell = document.createElement("div");
      cell.className = "calCell";

      const inMonth = d.getMonth() === m;
      if(!inMonth) cell.classList.add("outMonth");

      const key = ymd(d);
      const cnt = map.get(key) || 0;
      if(cnt > 0) cell.classList.add("hasData");

      const dn = document.createElement("div");
      dn.className = "dnum";
      dn.textContent = String(d.getDate());
      cell.appendChild(dn);

      if(cnt > 0){
        const small = document.createElement("div");
        small.style.fontSize = "11px";
        small.style.color = "rgba(235,245,255,.62)";
        small.style.fontWeight = "850";
        small.textContent = `${cnt} saved`;
        cell.appendChild(small);
      }

      cell.addEventListener("click", () => {
        if(cnt <= 0) return;
        openDayList(d.getTime());
      });

      grid.appendChild(cell);
    }
  }

  // -------------------------
  // Day list modal
  // -------------------------
  let currentDayTs = null;

  function getRecordsForDay(dayTs){
    const s = startOfDay(dayTs);
    const e = s + DAY_MS;
    return loadRecords().filter(r => r.ts >= s && r.ts < e).sort((a,b)=>b.ts-a.ts);
  }

  function openDayList(dayTs){
    currentDayTs = dayTs;
    $("dayListTitle").textContent = fmtDayTitle(dayTs);
    $("dayListSub").textContent = "Tap a number to view details.";
    $("dayLogoRow").innerHTML = $("logoTitle")?.innerHTML ? "" : "";

    const list = $("dayList");
    list.innerHTML = "";

    const recs = getRecordsForDay(dayTs);
    for(const r of recs){
      const item = document.createElement("div");
      item.className = "dayItem";

      const left = document.createElement("div");
      left.className = "dayLeft";

      const time = document.createElement("div");
      time.className = "dayTime";
      time.textContent = fmtTimeShort(r.ts);

      const num = document.createElement("div");
      num.className = "dayNum";
      num.textContent = r.number || "—";

      left.appendChild(time);
      left.appendChild(num);

      const notes = document.createElement("div");
      notes.className = "dayNotes";
      notes.textContent = (r.notes || "").trim() ? r.notes.trim() : "";

      const chev = document.createElement("div");
      chev.className = "chev";
      chev.textContent = "›";

      item.appendChild(left);
      item.appendChild(notes);
      item.appendChild(chev);

      item.addEventListener("click", () => {
        hide($("dayListModal"));
        lockTouch(false);
        openEditModal(r.id);
      });

      list.appendChild(item);
    }

    show($("dayListModal"));
    lockTouch(true);
  }

  function closeDayList(){
    hide($("dayListModal"));
    lockTouch(false);
  }

  // -------------------------
  // Edit modal
  // -------------------------
  let editId = null;
  let detailsVisible = false;

  function getRecordById(id){
    return loadRecords().find(r => r.id === id) || null;
  }

  function openEditModal(id){
    const r = getRecordById(id);
    if(!r){
      openInfo("Not found", "That entry could not be found.", {mode:"info"});
      return;
    }
    editId = id;
    detailsVisible = false;
    $("editDetailsBox").classList.add("hidden");
    $("btnToggleDetails").textContent = "View/Edit Details";

    $("editDT").value = toDTLocalValue(r.ts);
    $("editNum").value = r.number || "";
    $("editNotes").value = r.notes || "";

    const card = buildAngelCard(normalizeNumberInput(r.number));
    $("editAngelHeader").textContent = `Angel Card Number: ${normalizeNumberInput(r.number) || "—"}`;
    $("editAngelBig").textContent = normalizeNumberInput(r.number) || "—";
    $("editAngelCard").textContent = card.cardText || "—";
    $("editPattern").textContent = r.pattern || card.pattern || "—";

    show($("editModal"));
    lockTouch(true);
  }

  function closeEditModal(){
    hide($("editModal"));
    lockTouch(false);
    editId = null;
  }

  function toggleEditDetails(){
    detailsVisible = !detailsVisible;
    if(detailsVisible){
      $("editDetailsBox").classList.remove("hidden");
      $("btnToggleDetails").textContent = "Hide Details";
    }else{
      $("editDetailsBox").classList.add("hidden");
      $("btnToggleDetails").textContent = "View/Edit Details";
    }
  }

  function saveEdit(){
    if(!editId) return;
    const ts = fromDTLocalValue($("editDT").value);
    const num = normalizeNumberInput($("editNum").value);
    const notes = String($("editNotes").value || "").trim();

    if(!ts || !num){
      openInfo("Missing fields", "Date/time and Number are required.", {mode:"info"});
      return;
    }

    const card = buildAngelCard(num);
    const pattern = card.pattern || detectPattern(num);
    const meaning = card.headline || card.cardText || "";

    const ok = updateRecordById(editId, {
      ts,
      number: num,
      notes,
      pattern,
      meaning: meaning
    });

    if(!ok){
      openInfo("Error", "Could not save changes.", {mode:"info"});
      return;
    }

    renderCalendar();
    openInfo("Saved", "Entry updated.", {mode:"info"});
    closeEditModal();
  }

  function deleteEdit(){
    if(!editId) return;
    const id = editId;
    openInfo("Delete entry", "Tap OK to delete this entry.", {mode:"info"});
    const okBtn = $("btnInfoOk");
    const xBtn = $("btnInfoX");
    const originalOk = okBtn.onclick;
    const originalX = xBtn.onclick;

    okBtn.onclick = () => {
      closeInfo();
      deleteRecordById(id);
      renderCalendar();
      closeEditModal();
      openInfo("Deleted", "Entry removed.", {mode:"info"});
      // restore handlers
      okBtn.onclick = originalOk;
      xBtn.onclick = originalX;
    };
    xBtn.onclick = () => {
      closeInfo();
      okBtn.onclick = originalOk;
      xBtn.onclick = originalX;
    };
  }

  function exportSingleRecord(id){
    const r = getRecordById(id);
    if(!r){
      openInfo("Not found", "That entry could not be found.", {mode:"info"});
      return;
    }
    const text = buildReportAllRecords("Single Entry Export", [r]);
    openExport(text);
  }

  // -------------------------
  // Add modals
  // -------------------------
  function openAddFromHome(){
    const n = normalizeNumberInput(state.lastCardNumber || $("homeIdNum").value);
    if(!n){
      openInfo("Number required", "Submit a number first.", {mode:"info"});
      return;
    }
    $("addCalNumber").textContent = n;
    $("addCalNotes").value = "";
    $("addCalDT").value = toDTLocalValue(Date.now());
    show($("addCalModal"));
    lockTouch(true);
  }

  function closeAddFromHome(){
    hide($("addCalModal"));
    lockTouch(false);
  }

  function addFromHome(){
    const ts = fromDTLocalValue($("addCalDT").value);
    const num = normalizeNumberInput($("addCalNumber").textContent);
    const notes = String($("addCalNotes").value || "").trim();
    if(!ts || !num){
      openInfo("Missing fields", "Date/time and Number are required.", {mode:"info"});
      return;
    }
    const card = buildAngelCard(num);
    const rec = {
      id: makeId(ts),
      ts,
      number: num,
      pattern: card.pattern || detectPattern(num),
      meaning: card.headline || "",
      notes
    };
    addRecord(rec);
    renderCalendar();
    closeAddFromHome();
    openInfo("Saved", `Added to Calendar:\n\n${num}\n${fmtDateTime(ts)}`, {mode:"info"});
  }

  function openNewSighting(){
    $("newSightingDT").value = toDTLocalValue(Date.now());
    $("newSightingNum").value = "";
    $("newSightingNotes").value = "";
    show($("newSightingModal"));
    lockTouch(true);
  }

  function closeNewSighting(){
    hide($("newSightingModal"));
    lockTouch(false);
  }

  function addNewSighting(){
    const ts = fromDTLocalValue($("newSightingDT").value);
    const num = normalizeNumberInput($("newSightingNum").value);
    const notes = String($("newSightingNotes").value || "").trim();
    if(!ts || !num){
      openInfo("Missing fields", "Date/time and Number are required.", {mode:"info"});
      return;
    }
    const card = buildAngelCard(num);
    const rec = {
      id: makeId(ts),
      ts,
      number: num,
      pattern: card.pattern || detectPattern(num),
      meaning: card.headline || "",
      notes
    };
    addRecord(rec);
    renderCalendar();
    closeNewSighting();
    openInfo("Saved", `Added:\n\n${num}\n${fmtDateTime(ts)}`, {mode:"info"});
  }

  // -------------------------
  // Home export (all)
  // -------------------------
  function exportAll(){
    const recs = loadRecords();
    const text = buildReportAllRecords("Calendar Export (All Entries)", recs);
    openExport(text);
  }

  // -------------------------
  // Install buttons behavior
  // -------------------------
  function handleSmallInstallClick(){
    const btn = $("btnInstall");
    if(!btn) return;

    if(btn.dataset.mode === "uninstall"){
      openUninstallAndClose();
      return;
    }
    tryInstall();
  }

  function handleBigInstallClick(){
    if(isStandalone()){
      // Should not be visible, but keep safe.
      openUninstallAndClose();
      return;
    }
    tryInstall();
  }

  // -------------------------
  // Exit behavior
  // -------------------------
  function doExit(){
    closeAttempt();
  }

  // -------------------------
  // Init
  // -------------------------
  function initCalendarMonth(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    $("calMonth").value = `${y}-${m}`;
  }

  function wire(){
    setVersionLabels();

    // Initial install states
    updateInstallButton();
    updateBigInstallVisibility();

    // Home submit
    $("btnHomeSubmit").addEventListener("click", () => {
      renderCardToHome($("homeIdNum").value);
    });

    $("homeIdNum").addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        e.preventDefault();
        renderCardToHome($("homeIdNum").value);
      }
    });

    // Big install
    $("btnBigInstall").addEventListener("click", handleBigInstallClick);

    // Home actions
    $("btnAddToCalendar").addEventListener("click", openAddFromHome);
    $("btnViewCalendar").addEventListener("click", () => { setPanel(1, true); });
    $("btnInstall").addEventListener("click", handleSmallInstallClick);
    $("btnHomeExport").addEventListener("click", exportAll);
    $("btnExitHome").addEventListener("click", doExit);

    // Export modal buttons
    $("btnExportOk").addEventListener("click", closeExport);
    $("btnExportCopy").addEventListener("click", async () => {
      const ok = await copyToClipboard(currentExportText || "");
      openInfo(ok ? "Copied" : "Copy not available", ok ? "Report copied to clipboard." : "Your browser did not allow clipboard copy.", {mode:"info"});
    });
    $("btnExportShare").addEventListener("click", async () => {
      if(!isShareAvailable()){
        openInfo("Share not available", "Your browser does not support Share on this device.", {mode:"info"});
        return;
      }
      try{
        await navigator.share({ title: "Angel Code Report", text: currentExportText || "" });
      }catch{}
    });
    $("btnExportSave").addEventListener("click", async () => {
      const name = `angel_code_report_${APP_VERSION.replace(/\./g,"_")}.txt`;
      try{
        const ok = await saveTextWithPicker(currentExportText || "", name);
        if(!ok) downloadText(currentExportText || "", name);
      }catch{
        downloadText(currentExportText || "", name);
      }
    });

    // Add-from-home modal
    $("btnAddCalX").addEventListener("click", closeAddFromHome);
    $("btnAddCalCancel").addEventListener("click", closeAddFromHome);
    $("btnAddCalAdd").addEventListener("click", addFromHome);

    // Calendar
    initCalendarMonth();
    ensureDowRow();
    renderCalendar();

    $("calMonth").addEventListener("change", renderCalendar);
    $("btnCalAddNew").addEventListener("click", openNewSighting);
    $("btnBackFromCalendar").addEventListener("click", () => { setPanel(0, true); });

    // New sighting modal
    $("btnNewSightingX").addEventListener("click", closeNewSighting);
    $("btnNewSightingCancel").addEventListener("click", closeNewSighting);
    $("btnNewSightingAdd").addEventListener("click", addNewSighting);

    // Day list modal
    $("btnDayListClose").addEventListener("click", closeDayList);

    // Edit modal
    $("btnEditClose").addEventListener("click", closeEditModal);
    $("btnToggleDetails").addEventListener("click", toggleEditDetails);
    $("btnEditSave").addEventListener("click", saveEdit);
    $("btnEditDelete").addEventListener("click", deleteEdit);
    $("btnEditExport").addEventListener("click", () => exportSingleRecord(editId));

    // Info modal default close
    $("btnInfoOk").addEventListener("click", closeInfo);
    $("btnInfoX").addEventListener("click", closeInfo);

    // Initial panel
    setPanel(0, false);
  }

  wire();
})();
  </script>

<!--
Angel Code — EOF Version Detail Notes
App Version: v1.2A13
Base: v1.2A12
Changes (requested):
- Home panel Install/Uninstall button spans full panel width.
- Removed the “Shows only when install is available…” instruction line (kept “Swipe left to view Calendar.”).
- Home panel Uninstall now closes the tab/window after OK (same close behavior style as big install flow).
- Big Install button hides whenever an Export report is displayed; returns only after refresh and only if not installed + install is available.
-->
</body>
  </html>
