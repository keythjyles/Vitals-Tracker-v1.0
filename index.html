<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Vitals Tracker</title>
<style>
  :root{
    --bg:#0e1116;
    --panel:#121823;
    --text:#e8eef6;
    --muted:#9aa7b5;
    --border:#4aa3df; /* app border + accents */
    --btn:#4aa3df;
    --btnText:#06121a;
    --danger:#d64545;
    --dangerHover:#e05858;
    --input:#0f1620;
    --inputBorder:#3a4655;
    --divider:#263241;
    --focus:#86c9ff;
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family: Arial, Helvetica, sans-serif;
    line-height:1.25;
  }

  .app{
    max-width:520px;
    margin:16px auto;
    border:3px solid var(--border);
    border-radius:14px;
    padding:14px;
    background:linear-gradient(180deg, rgba(18,24,35,0.9), rgba(14,17,22,0.9));
  }

  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:6px 4px 10px;
    border-bottom:1px solid var(--divider);
    margin-bottom:12px;
  }

  .title{
    display:flex;
    flex-direction:column;
    gap:2px;
  }

  .title h1{
    margin:0;
    font-size:18px;
    letter-spacing:0.2px;
  }

  .title .sub{
    font-size:12px;
    color:var(--muted);
  }

  .badge{
    font-size:12px;
    color:var(--muted);
    border:1px solid var(--divider);
    border-radius:999px;
    padding:6px 10px;
    white-space:nowrap;
  }

  .panel{
    background:var(--panel);
    border:1px solid var(--divider);
    border-radius:12px;
    padding:12px;
    margin-bottom:12px;
  }

  .panel h2{
    margin:0 0 10px 0;
    font-size:15px;
  }

  .row{
    display:flex;
    gap:8px;
    align-items:center;
  }

  label{
    display:block;
    margin:0 0 6px 0;
    font-size:13px;
    color:var(--muted);
  }

  input[type="number"], input[type="text"], textarea, select{
    width:100%;
    background:var(--input);
    color:var(--text);
    border:1px solid var(--inputBorder);
    border-radius:10px;
    padding:10px;
    font-size:14px;
    outline:none;
  }

  input:focus, textarea:focus, select:focus, button:focus{
    box-shadow:0 0 0 3px rgba(134,201,255,0.25);
    border-color:var(--focus);
  }

  textarea{
    min-height:84px;
    resize:vertical;
  }

  .vitals-grid{
    display:grid;
    grid-template-columns:1fr 1fr 1fr;
    gap:8px;
  }

  .symptoms-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:8px 10px;
    margin-top:8px;
  }

  .check{
    display:flex;
    align-items:center;
    gap:8px;
    font-size:13px;
    color:var(--text);
    user-select:none;
  }

  .check input{ transform:scale(1.15); }

  .btnrow{
    display:flex;
    gap:10px;
    margin-top:10px;
  }

  button{
    width:100%;
    padding:12px 12px;
    border:none;
    border-radius:12px;
    cursor:pointer;
    background:var(--btn);
    color:var(--btnText);
    font-weight:700;
    font-size:14px;
  }
  button:hover{ filter:brightness(1.05); }

  .secondary{
    background:transparent;
    color:var(--text);
    border:1px solid var(--divider);
    font-weight:700;
  }

  .danger{
    background:var(--danger);
    color:#fff;
  }
  .danger:hover{ background:var(--dangerHover); }

  .navrow{
    display:flex;
    gap:10px;
  }

  .tiny{
    font-size:12px;
    color:var(--muted);
    margin-top:8px;
  }

  .logbox{
    max-height:260px;
    overflow:auto;
    border:1px solid var(--divider);
    border-radius:12px;
    padding:10px;
    background:rgba(0,0,0,0.18);
  }

  .entry{
    border-bottom:1px solid var(--divider);
    padding:10px 0;
  }
  .entry:last-child{ border-bottom:none; }

  .entry .t{
    font-weight:700;
    font-size:13px;
  }
  .entry .m{
    font-size:13px;
    margin-top:6px;
  }
  .pill{
    display:inline-block;
    border:1px solid var(--divider);
    border-radius:999px;
    padding:3px 8px;
    font-size:12px;
    color:var(--muted);
    margin-right:6px;
    margin-top:6px;
  }

  .hidden{ display:none; }
</style>
</head>
<body>

<div class="app" role="application" aria-label="Vitals Tracker">
  <header>
    <div class="title">
      <h1>Vitals Tracker</h1>
      <div class="sub">Multi-panel baseline rebuild</div>
    </div>
    <div class="badge" id="panelBadge">Panel 1 of 3</div>
  </header>

  <!-- PANEL 1: ENTER VITALS -->
  <section class="panel" id="panel1">
    <h2>Enter Vitals</h2>

    <label for="when">Timestamp</label>
    <div class="row">
      <select id="when" aria-label="Timestamp mode">
        <option value="now">Now</option>
        <option value="manual">Manual (edit below)</option>
      </select>
    </div>
    <div style="margin-top:8px;">
      <input type="text" id="manualTime" placeholder="e.g., 12/24/2025 12:05 AM" class="hidden" aria-label="Manual timestamp"/>
      <div class="tiny" id="nowPreview"></div>
    </div>

    <div style="margin-top:12px;">
      <label>SYS / DIA / HR</label>
      <div class="vitals-grid">
        <input type="number" id="sys" placeholder="SYS" inputmode="numeric" aria-label="Systolic"/>
        <input type="number" id="dia" placeholder="DIA" inputmode="numeric" aria-label="Diastolic"/>
        <input type="number" id="hr"  placeholder="HR"  inputmode="numeric" aria-label="Heart rate"/>
      </div>
      <div class="tiny">Enter your measured values exactly as shown on the cuff.</div>
    </div>

    <div class="btnrow">
      <button class="secondary" id="clearVitals">Clear</button>
      <button id="toSymptoms">Next</button>
    </div>
  </section>

  <!-- PANEL 2: SYMPTOMS -->
  <section class="panel hidden" id="panel2">
    <h2>Symptoms</h2>

    <label>Choose symptoms (two-column list)</label>
    <div class="symptoms-grid" id="symptomGrid" aria-label="Symptoms list"></div>

    <div style="margin-top:12px;">
      <label for="customSymptom">Add a symptom (always shows later)</label>
      <div class="row">
        <input type="text" id="customSymptom" placeholder="Type symptom name…" aria-label="Custom symptom"/>
      </div>
      <div class="btnrow">
        <button class="secondary" id="addSymptomBtn">Add Symptom</button>
        <button id="toNotes">Next</button>
      </div>
      <div class="tiny">Custom symptoms are saved on this device.</div>
    </div>

    <div class="btnrow">
      <button class="secondary" id="backToVitals">Back</button>
      <button class="danger" id="exitBtn2">Exit</button>
    </div>
  </section>

  <!-- PANEL 3: NOTES + SAVE + LOG -->
  <section class="panel hidden" id="panel3">
    <h2>Notes & Log</h2>

    <label for="notes">Notes (context, meds, triggers, what happened)</label>
    <textarea id="notes" placeholder="Example: chest tight, dizzy; took lisinopril; woke up sweating; anxiety spike…" aria-label="Notes"></textarea>

    <div class="btnrow">
      <button class="secondary" id="backToSymptoms">Back</button>
      <button id="saveBtn">Save Entry</button>
    </div>

    <div class="btnrow">
      <button class="secondary" id="exportCsv">Export CSV</button>
      <button class="secondary" id="printPdf">Print / PDF</button>
    </div>

    <div class="btnrow">
      <button class="secondary" id="clearAll">Clear All Data</button>
      <button class="danger" id="exitBtn3">Exit</button>
    </div>

    <div style="margin-top:12px;">
      <label>Saved Entries</label>
      <div class="logbox" id="log" aria-label="Saved entries log"></div>
      <div class="tiny">Stored locally on this device only.</div>
    </div>
  </section>

</div>

<script>
(function(){
  // Storage keys
  const KEY_ENTRIES = "vitals_entries";
  const KEY_CUSTOM_SYM = "vitals_custom_symptoms";

  // Baseline symptom set (simple, common, matches your past logging)
  const defaultSymptoms = [
    "Chest tight", "Dizzy", "Nausea", "Sweaty",
    "Blurred vision", "Weakness", "Headache", "Anxiety",
    "Panic", "Hot ears", "Itching", "Stomach pain"
  ];

  // Elements
  const panel1 = document.getElementById("panel1");
  const panel2 = document.getElementById("panel2");
  const panel3 = document.getElementById("panel3");
  const panelBadge = document.getElementById("panelBadge");

  const whenSel = document.getElementById("when");
  const manualTime = document.getElementById("manualTime");
  const nowPreview = document.getElementById("nowPreview");

  const sys = document.getElementById("sys");
  const dia = document.getElementById("dia");
  const hr  = document.getElementById("hr");
  const notes = document.getElementById("notes");

  const symptomGrid = document.getElementById("symptomGrid");
  const customSymptom = document.getElementById("customSymptom");

  const log = document.getElementById("log");

  // State (current draft entry before save)
  let draft = {
    timeMode: "now",
    timeText: "",
    sys: "",
    dia: "",
    hr: "",
    symptoms: [],
    notes: ""
  };

  function setPanel(n){
    panel1.classList.toggle("hidden", n!==1);
    panel2.classList.toggle("hidden", n!==2);
    panel3.classList.toggle("hidden", n!==3);
    panelBadge.textContent = `Panel ${n} of 3`;
  }

  function nowString(){
    return new Date().toLocaleString();
  }

  function updateNowPreview(){
    if(whenSel.value === "now"){
      nowPreview.textContent = `Current time: ${nowString()}`;
    } else {
      nowPreview.textContent = "";
    }
  }

  function loadCustomSymptoms(){
    try{
      return JSON.parse(localStorage.getItem(KEY_CUSTOM_SYM) || "[]");
    }catch{
      return [];
    }
  }

  function saveCustomSymptoms(list){
    localStorage.setItem(KEY_CUSTOM_SYM, JSON.stringify(list));
  }

  function allSymptoms(){
    const custom = loadCustomSymptoms();
    // Deduplicate while preserving order
    const seen = new Set();
    const merged = [];
    [...defaultSymptoms, ...custom].forEach(s=>{
      const k = String(s).trim();
      if(!k) return;
      const key = k.toLowerCase();
      if(seen.has(key)) return;
      seen.add(key);
      merged.push(k);
    });
    return merged;
  }

  function renderSymptoms(){
    symptomGrid.innerHTML = "";
    const items = allSymptoms();

    items.forEach(name=>{
      const id = "sym_" + name.toLowerCase().replace(/[^a-z0-9]+/g,"_");
      const wrap = document.createElement("label");
      wrap.className = "check";
      wrap.setAttribute("for", id);

      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.id = id;
      cb.value = name;
      cb.checked = draft.symptoms.includes(name);
      cb.addEventListener("change", ()=>{
        if(cb.checked){
          if(!draft.symptoms.includes(name)) draft.symptoms.push(name);
        } else {
          draft.symptoms = draft.symptoms.filter(x=>x!==name);
        }
      });

      const text = document.createElement("span");
      text.textContent = name;

      wrap.appendChild(cb);
      wrap.appendChild(text);
      symptomGrid.appendChild(wrap);
    });
  }

  function getEntries(){
    try{
      return JSON.parse(localStorage.getItem(KEY_ENTRIES) || "[]");
    }catch{
      return [];
    }
  }

  function setEntries(entries){
    localStorage.setItem(KEY_ENTRIES, JSON.stringify(entries));
  }

  function renderLog(){
    const entries = getEntries();
    log.innerHTML = "";

    if(entries.length === 0){
      const div = document.createElement("div");
      div.className = "entry";
      div.innerHTML = `<div class="t">No entries yet.</div><div class="m">Add an entry and it will appear here.</div>`;
      log.appendChild(div);
      return;
    }

    entries.forEach(e=>{
      const div = document.createElement("div");
      div.className = "entry";

      const vitalsLine = `BP: ${e.sys}/${e.dia} · HR: ${e.hr}`;
      const sym = Array.isArray(e.symptoms) && e.symptoms.length ? e.symptoms : [];

      div.innerHTML = `
        <div class="t">${escapeHtml(e.time)}</div>
        <div class="m">${escapeHtml(vitalsLine)}</div>
        <div class="m">${sym.map(s=>`<span class="pill">${escapeHtml(s)}</span>`).join("") || `<span class="pill">No symptoms</span>`}</div>
        <div class="m"><span class="pill">Notes</span> ${escapeHtml(e.notes || "-")}</div>
      `;
      log.appendChild(div);
    });
  }

  function escapeHtml(s){
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function clearVitalsInputs(){
    sys.value = "";
    dia.value = "";
    hr.value = "";
  }

  function validateVitals(){
    const s = Number(sys.value);
    const d = Number(dia.value);
    const h = Number(hr.value);
    if(!s || !d || !h) return "Enter SYS, DIA, and HR.";
    if(s < 50 || s > 300) return "SYS looks out of range.";
    if(d < 30 || d > 200) return "DIA looks out of range.";
    if(h < 20 || h > 250) return "HR looks out of range.";
    return "";
  }

  function currentTimestampText(){
    if(whenSel.value === "now") return nowString();
    const t = manualTime.value.trim();
    return t || nowString();
  }

  // Navigation buttons
  document.getElementById("toSymptoms").addEventListener("click", ()=>{
    const err = validateVitals();
    if(err){ alert(err); return; }

    draft.sys = sys.value.trim();
    draft.dia = dia.value.trim();
    draft.hr  = hr.value.trim();

    draft.timeMode = whenSel.value;
    draft.timeText = currentTimestampText();

    renderSymptoms();
    setPanel(2);
  });

  document.getElementById("toNotes").addEventListener("click", ()=>{
    setPanel(3);
    renderLog();
  });

  document.getElementById("backToVitals").addEventListener("click", ()=> setPanel(1));
  document.getElementById("backToSymptoms").addEventListener("click", ()=> setPanel(2));

  // Timestamp mode
  whenSel.addEventListener("change", ()=>{
    if(whenSel.value === "manual"){
      manualTime.classList.remove("hidden");
      manualTime.focus();
    } else {
      manualTime.classList.add("hidden");
      manualTime.value = "";
    }
    updateNowPreview();
  });

  // Clear vitals
  document.getElementById("clearVitals").addEventListener("click", ()=>{
    clearVitalsInputs();
    sys.focus();
  });

  // Add custom symptom
  document.getElementById("addSymptomBtn").addEventListener("click", ()=>{
    const name = customSymptom.value.trim();
    if(!name){ alert("Type a symptom name first."); return; }

    const current = loadCustomSymptoms();
    const exists = current.some(x=>String(x).toLowerCase() === name.toLowerCase());
    if(!exists){
      current.push(name);
      saveCustomSymptoms(current);
    }

    customSymptom.value = "";
    renderSymptoms();
  });

  // Save entry
  document.getElementById("saveBtn").addEventListener("click", ()=>{
    const err = validateVitals();
    if(err){ alert(err); return; }

    const entry = {
      time: currentTimestampText(),
      sys: sys.value.trim(),
      dia: dia.value.trim(),
      hr:  hr.value.trim(),
      symptoms: Array.isArray(draft.symptoms) ? [...draft.symptoms] : [],
      notes: notes.value.trim()
    };

    const entries = getEntries();
    entries.unshift(entry);
    setEntries(entries);

    // reset draft + inputs
    draft.symptoms = [];
    notes.value = "";
    customSymptom.value = "";

    renderSymptoms();
    renderLog();
    alert("Saved.");
  });

  // Export CSV
  document.getElementById("exportCsv").addEventListener("click", ()=>{
    const entries = getEntries();
    const header = ["time","sys","dia","hr","symptoms","notes"];
    const rows = entries.map(e=>{
      const sym = (e.symptoms||[]).join("; ");
      const n = (e.notes||"").replaceAll("\n"," ").trim();
      return [
        csvCell(e.time),
        csvCell(e.sys),
        csvCell(e.dia),
        csvCell(e.hr),
        csvCell(sym),
        csvCell(n)
      ].join(",");
    });
    const csv = [header.join(","), ...rows].join("\n");

    const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "vitals_tracker.csv";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  function csvCell(val){
    const s = String(val ?? "");
    if(/[",\n]/.test(s)) return `"${s.replaceAll('"','""')}"`;
    return s;
  }

  // Print / PDF
  document.getElementById("printPdf").addEventListener("click", ()=>{
    window.print();
  });

  // Clear all data
  document.getElementById("clearAll").addEventListener("click", ()=>{
    const ok = confirm("This deletes all saved entries on this device. Continue?");
    if(!ok) return;
    localStorage.removeItem(KEY_ENTRIES);
    renderLog();
    alert("Cleared.");
  });

  // Exit buttons (red)
  function exitApp(){
    // Most mobile browsers won’t allow scripted close unless opened by script.
    // So we provide a clean “exit” by navigating to a blank page.
    window.location.href = "about:blank";
  }
  document.getElementById("exitBtn2").addEventListener("click", exitApp);
  document.getElementById("exitBtn3").addEventListener("click", exitApp);

  // Initial render
  updateNowPreview();
  renderSymptoms();
  renderLog();
  setPanel(1);
})();
</script>
</body>
</html>
