<!-- ===========================
File: /index.html
Vitals Tracker — v2.012

Change intent (visibility + certainty)
- This update is ONLY to make it unmistakable that you are on the new build:
  * Version bumped to v2.012
  * “BOOT OK” reflects v2.012
  * Clear “Build stamp” line on Home

Functional intent (no feature regression)
- Keeps the same structure expected by /js/app.js (v2.011):
  #chartCanvas, #logList, #logFooter, #statusLine
- Does not alter storage keys or delete any data.

=========================== -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1324" />
  <title>Vitals Tracker</title>

  <!-- PWA -->
  <link rel="manifest" id="manifestLink" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <style>
    :root{
      --bg0:#08101f;
      --bg1:#0b1324;
      --panel:#0c1528cc;
      --stroke:rgba(235,245,255,.16);
      --stroke2:rgba(235,245,255,.22);
      --strokeBold:rgba(180,210,255,.42);
      --text:rgba(235,245,255,.90);
      --muted:rgba(235,245,255,.58);
      --muted2:rgba(235,245,255,.42);
      --accent:#2b4e7a;
      --shadow:0 18px 50px rgba(0,0,0,.45);
      --radius:26px;
      --radius2:20px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(180deg,var(--bg1),var(--bg0));
      color:var(--text);
      -webkit-tap-highlight-color:transparent;
      overscroll-behavior-y:contain;
    }

    .wrap{
      max-width:520px;
      margin:0 auto;
      padding:18px 14px 24px;
    }

    .shell{
      border:2px solid rgba(130,180,255,.35);
      border-radius:34px;
      padding:14px;
      box-shadow:var(--shadow);
      background:radial-gradient(1200px 700px at 15% 10%, rgba(100,170,255,.22), transparent 55%),
                 radial-gradient(900px 600px at 80% 25%, rgba(120,200,255,.10), transparent 60%),
                 linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    }

    .topbar{
      border:1px solid var(--stroke2);
      border-radius:999px;
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    }
    .title{
      font-weight:800;
      font-size:34px;
      letter-spacing:.2px;
      opacity:.95;
    }
    .boot{
      font-size:16px;
      font-weight:700;
      letter-spacing:.2px;
      opacity:.55;
      white-space:nowrap;
    }

    .tabs{
      margin-top:14px;
      border:1px solid var(--stroke2);
      border-radius:999px;
      padding:10px;
      display:flex;
      gap:10px;
      justify-content:space-between;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    }
    .tab{
      flex:1;
      border:1px solid var(--stroke);
      border-radius:999px;
      padding:12px 10px;
      text-align:center;
      color:var(--muted);
      font-weight:800;
      background:rgba(0,0,0,.10);
      user-select:none;
    }
    .tab[aria-current="page"]{
      color:var(--text);
      border-color:rgba(160,210,255,.55);
      background:linear-gradient(180deg, rgba(120,190,255,.22), rgba(255,255,255,.03));
    }

    .panel{
      margin-top:14px;
      border:2px solid rgba(130,180,255,.35);
      border-radius:34px;
      padding:16px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      min-height:520px;
    }

    .card{
      border:1px solid var(--stroke2);
      border-radius:26px;
      padding:14px;
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.10));
    }

    .muted{color:var(--muted)}
    .muted2{color:var(--muted2)}
    .sp8{height:8px}
    .sp10{height:10px}
    .sp14{height:14px}

    .btn{
      width:100%;
      border:1px solid var(--stroke2);
      border-radius:999px;
      padding:14px 14px;
      font-weight:900;
      font-size:18px;
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.18));
      color:var(--text);
    }
    .btn:active{transform:translateY(1px)}

    /* Log cards that app.js expects */
    .ro-card{
      border:1px solid var(--stroke2);
      border-radius:22px;
      padding:12px 12px;
      margin-top:10px;
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.14));
    }
    .ro-top{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
    }
    .ro-bp{
      font-weight:950;
      font-size:26px;
      letter-spacing:.2px;
    }
    .ro-hr{
      font-weight:900;
      font-size:14px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      color:var(--muted);
      white-space:nowrap;
    }
    .ro-when{
      margin-top:6px;
      font-size:14px;
      color:var(--muted);
      line-height:1.25;
      word-break:break-word;
    }
    .ro-footer{
      margin-top:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:stretch;
    }
    .ro-loadmore{
      font-size:16px;
      padding:12px 14px;
    }

    /* Chart container: panel can scroll, but chart itself uses pointer capture for pan/zoom */
    .chartWrap{
      border:1px solid var(--stroke2);
      border-radius:26px;
      padding:10px;
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.14));
    }
    canvas{
      width:100%;
      height:520px;
      display:block;
      border-radius:18px;
      background:rgba(0,0,0,.12);
    }

    /* Sections */
    .h1{
      font-size:32px;
      font-weight:900;
      margin:0 0 10px 0;
      opacity:.95;
    }
    .note{
      font-size:18px;
      line-height:1.35;
      color:var(--muted);
    }

    .homeLine{
      margin-top:10px;
      font-size:16px;
      color:var(--muted);
      line-height:1.35;
    }
    .stamp{
      margin-top:10px;
      font-size:14px;
      color:rgba(235,245,255,.70);
      font-weight:800;
      letter-spacing:.2px;
    }

    /* Hide panels */
    .hidden{display:none !important}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="shell">
      <div class="topbar">
        <div class="title">Vitals Tracker</div>
        <div id="statusLine" class="boot">BOOT OK v2.012</div>
      </div>

      <div class="tabs" role="tablist" aria-label="Primary">
        <div class="tab" id="tabHome"   role="tab" tabindex="0" aria-current="page">Home</div>
        <div class="tab" id="tabLog"    role="tab" tabindex="0">Log</div>
        <div class="tab" id="tabCharts" role="tab" tabindex="0">Charts</div>
        <div class="tab" id="tabInstall" role="tab" tabindex="0">Install</div>
      </div>

      <!-- HOME -->
      <section class="panel" id="panelHome">
        <div class="card">
          <div class="note">
            Function-first shell. Data detection is read-only.
          </div>
          <div class="sp10"></div>
          <div class="homeLine">Pull down on Home to refresh (release).</div>
          <div class="homeLine">Storage bridge loaded.</div>
          <div class="stamp">BUILD STAMP: v2.012 • index.html updated</div>
        </div>

        <div class="sp14"></div>

        <div class="card" id="homeDetectCard">
          <div class="h1" style="margin-bottom:6px;">Data Detected (Read-Only)</div>
          <div class="muted2">This screen is informational. No data is modified.</div>
          <div class="sp10"></div>

          <div class="muted" id="homeDetectLine">Detecting…</div>
        </div>
      </section>

      <!-- LOG -->
      <section class="panel hidden" id="panelLog" aria-label="Log">
        <div class="h1">Log (read-only preview)</div>
        <div class="muted">Newest first. Timestamps shown in Central Time.</div>

        <div class="sp10"></div>

        <div id="logList"></div>
        <div id="logFooter"></div>
      </section>

      <!-- CHARTS -->
      <section class="panel hidden" id="panelCharts" aria-label="Charts">
        <div class="h1">Charts (Read-Only)</div>
        <div class="muted">Pinch left/right to zoom 2–14 days. Drag left/right to pan. Central Time axis.</div>

        <div class="sp10"></div>

        <div class="chartWrap">
          <canvas id="chartCanvas" aria-label="Vitals chart"></canvas>
        </div>

        <div class="sp10"></div>
        <div class="muted2">Time-spaced plot. Sys/Dia drawn when present; HR drawn when present.</div>
      </section>

      <!-- INSTALL -->
      <section class="panel hidden" id="panelInstall" aria-label="Install">
        <div class="h1">Install</div>
        <div class="muted">Use your browser menu → “Add to Home screen” (Android) or “Install app”.</div>
        <div class="sp14"></div>
        <button id="btnInstall" class="btn" type="button">Install</button>
        <div class="sp10"></div>
        <div class="muted2">If the Install button does nothing, your browser may require using the menu instead.</div>
      </section>
    </div>
  </div>

  <script>
    // Minimal tab switching (kept in index so it always works even if app.js fails)
    (function(){
      const tabs = {
        tabHome:   { tab: document.getElementById("tabHome"),   panel: document.getElementById("panelHome") },
        tabLog:    { tab: document.getElementById("tabLog"),    panel: document.getElementById("panelLog") },
        tabCharts: { tab: document.getElementById("tabCharts"), panel: document.getElementById("panelCharts") },
        tabInstall:{ tab: document.getElementById("tabInstall"),panel: document.getElementById("panelInstall") },
      };

      function activate(key){
        Object.keys(tabs).forEach(k=>{
          const on = (k === key);
          tabs[k].panel.classList.toggle("hidden", !on);
          tabs[k].tab.setAttribute("aria-current", on ? "page" : "false");
        });
        window.scrollTo({ top: 0, behavior: "instant" });
      }

      Object.keys(tabs).forEach(k=>{
        tabs[k].tab.addEventListener("click", ()=>activate(k), { passive:true });
      });

      // Default
      activate("tabHome");

      // Pull-to-refresh on Home (release)
      let startY = 0, pulling = false;
      const home = document.getElementById("panelHome");
      home.addEventListener("touchstart", (e)=>{
        if (home.scrollTop === 0) { startY = e.touches[0].clientY; pulling = true; }
      }, { passive:true });
      home.addEventListener("touchmove", (e)=>{
        if (!pulling) return;
        const dy = e.touches[0].clientY - startY;
        if (dy > 80) { /* visual cue could be added later */ }
      }, { passive:true });
      home.addEventListener("touchend", (e)=>{
        if (!pulling) return;
        pulling = false;
        const endY = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0].clientY : startY;
        if (endY - startY > 90) location.reload();
      }, { passive:true });

      // Install (best-effort)
      let deferred = null;
      window.addEventListener("beforeinstallprompt", (e)=>{
        e.preventDefault();
        deferred = e;
      });
      document.getElementById("btnInstall").addEventListener("click", async ()=>{
        try{
          if (!deferred) return;
          deferred.prompt();
          await deferred.userChoice;
          deferred = null;
        }catch(_){}
      }, { passive:true });
    })();
  </script>

  <!-- Storage bridge + app controller -->
  <script src="js/storage.js"></script>
  <script src="js/app.js"></script>

  <script>
    // Home detect summary (read-only). Uses VT_STORAGE if present.
    (async function(){
      const line = document.getElementById("homeDetectLine");
      function set(txt){ if(line) line.textContent = txt; }

      if (!window.VT_STORAGE || typeof window.VT_STORAGE.getAllRecordsReadOnly !== "function") {
        set("Storage bridge not detected.");
        return;
      }

      try{
        const recs = await window.VT_STORAGE.getAllRecordsReadOnly();
        const n = Array.isArray(recs) ? recs.length : 0;
        let newest = "—";
        if (n) {
          let max = 0;
          for (const r of recs) {
            const d = new Date(r?.ts || r?.timestamp || r?.time || r?.date || r?.createdAt || r?.updatedAt);
            const t = d && !isNaN(d.getTime()) ? d.getTime() : 0;
            if (t > max) max = t;
          }
          if (max) newest = new Date(max).toISOString();
        }
        set(`Source: localStorage/IndexedDB (read-only) • Entries: ${n} • Newest: ${newest}`);
      }catch(e){
        set(`Storage read error: ${String(e?.message || e)}`);
      }
    })();
  </script>
</body>
</html>

<!-- ===========================
File: /index.html
End of file — v2.012
Notes
- This file is intentionally verbose in the header/footer comments so you can confirm the exact build.
- If you still see the prior version after updating, it is almost always service-worker cache.
  Do this on Android Chrome:
  1) Long-press app icon → App info → Storage → Clear cache (or Clear storage if needed)
  2) Or open the site → Chrome menu → “Delete browsing data” (site data) for keythjyles.github.io
=========================== -->
